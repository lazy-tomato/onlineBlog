<!DOCTYPE html>
<html lang="zh-CN">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <meta name="generator" content="VuePress 2.0.0-beta.53">
    <style>
      :root {
        --c-bg: #fff;
      }
      html.dark {
        --c-bg: #22272e;
      }
      html, body {
        background-color: var(--c-bg);
      }
    </style>
    <script>
      const userMode = localStorage.getItem('vuepress-color-scheme');
			const systemDarkMode = window.matchMedia && window.matchMedia('(prefers-color-scheme: dark)').matches;
			if (userMode === 'dark' || (userMode !== 'light' && systemDarkMode)) {
				document.documentElement.classList.toggle('dark', true);
			}
    </script>
    <link rel="shortcut icon" type="image/x-icon" href="/onlineBlog/images/favicon.ico"><script>
        var _hmt = _hmt || [];
        (function() {
          var hm = document.createElement("script");
          hm.src = "https://hm.baidu.com/hm.js?338707764965b0734a54d256624e76ed";
          var s = document.getElementsByTagName("script")[0]; 
          s.parentNode.insertBefore(hm, s);
        })();
        </script><title>Vue 中的 nextTick__番茄出品 | tomato</title><meta name="description" content="用于记录自己学习笔记的网站。作者：番茄">
    <link rel="preload" href="/onlineBlog/assets/style.73905904.css" as="style" /><link rel="stylesheet" href="/onlineBlog/assets/style.73905904.css" />
    <link rel="modulepreload" href="/onlineBlog/assets/app.acfc35a6.js"><link rel="modulepreload" href="/onlineBlog/assets/6.vue中的nextTick.html.0984dc82.js"><link rel="modulepreload" href="/onlineBlog/assets/6.vue中的nextTick.html.adf85ab8.js"><link rel="prefetch" href="/onlineBlog/assets/index.html.b12671fe.js" as="script" /><link rel="prefetch" href="/onlineBlog/assets/index.html.e6676d3e.js" as="script" /><link rel="prefetch" href="/onlineBlog/assets/index.html.2da8cd7f.js" as="script" /><link rel="prefetch" href="/onlineBlog/assets/index.html.4715091f.js" as="script" /><link rel="prefetch" href="/onlineBlog/assets/如何发布一个属于自己的npm包.html.7d17fea8.js" as="script" /><link rel="prefetch" href="/onlineBlog/assets/02.初步认识.html.fefdcd86.js" as="script" /><link rel="prefetch" href="/onlineBlog/assets/03.下载安装.html.37c140bc.js" as="script" /><link rel="prefetch" href="/onlineBlog/assets/04.HelloTypeScript.html.6fdf4d49.js" as="script" /><link rel="prefetch" href="/onlineBlog/assets/05.数据类型.html.3facb593.js" as="script" /><link rel="prefetch" href="/onlineBlog/assets/06.数组的类型.html.8977fb51.js" as="script" /><link rel="prefetch" href="/onlineBlog/assets/07.函数的类型.html.20e720d8.js" as="script" /><link rel="prefetch" href="/onlineBlog/assets/08.类型断言.html.d9e4cc6e.js" as="script" /><link rel="prefetch" href="/onlineBlog/assets/1.readme.html.cac5831b.js" as="script" /><link rel="prefetch" href="/onlineBlog/assets/01.如何理解Html的语义化.html.096d56c4.js" as="script" /><link rel="prefetch" href="/onlineBlog/assets/02.script标签中defer和async的区别.html.a2124b96.js" as="script" /><link rel="prefetch" href="/onlineBlog/assets/03.从浏览器地址栏输入url到请求返回发生了什么.html.3eb6577e.js" as="script" /><link rel="prefetch" href="/onlineBlog/assets/04.css盒子模型.html.884c16ba.js" as="script" /><link rel="prefetch" href="/onlineBlog/assets/05.css选择器和优先级.html.5c693d55.js" as="script" /><link rel="prefetch" href="/onlineBlog/assets/06.重排重绘.html.8aa545b9.js" as="script" /><link rel="prefetch" href="/onlineBlog/assets/07.对BFC的理解.html.86c3dbab.js" as="script" /><link rel="prefetch" href="/onlineBlog/assets/08.水平垂直居中多种实现方式.html.b3730779.js" as="script" /><link rel="prefetch" href="/onlineBlog/assets/09.line-height如何继承.html.b2bee388.js" as="script" /><link rel="prefetch" href="/onlineBlog/assets/end.html.d541a8a5.js" as="script" /><link rel="prefetch" href="/onlineBlog/assets/01.说说闭包(高频).html.b9fa7f73.js" as="script" /><link rel="prefetch" href="/onlineBlog/assets/02.说说箭头函数.html.107e2e5b.js" as="script" /><link rel="prefetch" href="/onlineBlog/assets/03.说说JS的模块化.html.08474d4c.js" as="script" /><link rel="prefetch" href="/onlineBlog/assets/04.说说this.html.8abc2b6b.js" as="script" /><link rel="prefetch" href="/onlineBlog/assets/05.说说async和await.html.10180581.js" as="script" /><link rel="prefetch" href="/onlineBlog/assets/06.说说Promise(待完善).html.f069b175.js" as="script" /><link rel="prefetch" href="/onlineBlog/assets/07.深拷贝和浅拷贝的区别(待完善).html.431c93aa.js" as="script" /><link rel="prefetch" href="/onlineBlog/assets/08.比较 typeof instanceof.html.48c4537a.js" as="script" /><link rel="prefetch" href="/onlineBlog/assets/09.构造函数、原型对象、实例对象三者关系.html.85558f2f.js" as="script" /><link rel="prefetch" href="/onlineBlog/assets/10.数组的forEach、map、every、some、filter区别？.html.0d508aa1.js" as="script" /><link rel="prefetch" href="/onlineBlog/assets/11.怎么理解宏任务和微任务的(待完善).html.79f87c06.js" as="script" /><link rel="prefetch" href="/onlineBlog/assets/12.对象方法或者属性的查找规则是怎样的？.html.769ce6c7.js" as="script" /><link rel="prefetch" href="/onlineBlog/assets/13.什么是高阶函数.html.f62f3a45.js" as="script" /><link rel="prefetch" href="/onlineBlog/assets/14.什么是原型链.html.6fc79caa.js" as="script" /><link rel="prefetch" href="/onlineBlog/assets/15.ES6新特性.html.34865af5.js" as="script" /><link rel="prefetch" href="/onlineBlog/assets/16.let、const、var关键字的区别.html.80ee0313.js" as="script" /><link rel="prefetch" href="/onlineBlog/assets/17.JS中数组的常见方法.html.6a3bbcc8.js" as="script" /><link rel="prefetch" href="/onlineBlog/assets/18.JS中创建对象的几种方式(待完善).html.d4d1f041.js" as="script" /><link rel="prefetch" href="/onlineBlog/assets/19.JS中字符串的常见方法(待完善).html.35d07333.js" as="script" /><link rel="prefetch" href="/onlineBlog/assets/20.说说export和export default的区别.html.53699f75.js" as="script" /><link rel="prefetch" href="/onlineBlog/assets/21.说说call_apply_bind(待完善).html.f8ce0fd7.js" as="script" /><link rel="prefetch" href="/onlineBlog/assets/22.谈谈垃圾回收机制及内存管理.html.2ff188f4.js" as="script" /><link rel="prefetch" href="/onlineBlog/assets/23.说说ES6中的解构.html.8ab7257b.js" as="script" /><link rel="prefetch" href="/onlineBlog/assets/24.说说构造函数原型 prototype.html.8c65863b.js" as="script" /><link rel="prefetch" href="/onlineBlog/assets/25.说说对象原型__proto__.html.c1e79fc7.js" as="script" /><link rel="prefetch" href="/onlineBlog/assets/26.JS中的继承(待完善).html.8677798c.js" as="script" /><link rel="prefetch" href="/onlineBlog/assets/27.手写深拷贝.html.9b26a008.js" as="script" /><link rel="prefetch" href="/onlineBlog/assets/28.0.1_0.2不等于0.3.html.897d48e8.js" as="script" /><link rel="prefetch" href="/onlineBlog/assets/29.new.html.3f223cb8.js" as="script" /><link rel="prefetch" href="/onlineBlog/assets/30.cookie_localStorage_sessionStorage.html.36702b99.js" as="script" /><link rel="prefetch" href="/onlineBlog/assets/31.跨域.html.6be5bb50.js" as="script" /><link rel="prefetch" href="/onlineBlog/assets/end.html.8abb58e9.js" as="script" /><link rel="prefetch" href="/onlineBlog/assets/1.html.dbcc8223.js" as="script" /><link rel="prefetch" href="/onlineBlog/assets/1.html.fd2112ba.js" as="script" /><link rel="prefetch" href="/onlineBlog/assets/1.html.5262cbdf.js" as="script" /><link rel="prefetch" href="/onlineBlog/assets/01.vue中路由传参.html.c262ef97.js" as="script" /><link rel="prefetch" href="/onlineBlog/assets/02.谈谈你对导航守卫的了解.html.37061451.js" as="script" /><link rel="prefetch" href="/onlineBlog/assets/03.谈谈你对MVVM的理解.html.9b1b138c.js" as="script" /><link rel="prefetch" href="/onlineBlog/assets/04.说说vue中的生命周期钩子.html.5f6e34d9.js" as="script" /><link rel="prefetch" href="/onlineBlog/assets/05.说说Vue的优点.html.19270a19.js" as="script" /><link rel="prefetch" href="/onlineBlog/assets/06.data为什么是一个函数？.html.1d7e47e1.js" as="script" /><link rel="prefetch" href="/onlineBlog/assets/07._.sync_的作用是什么？.html.2c9fe9df.js" as="script" /><link rel="prefetch" href="/onlineBlog/assets/08.computed和watch，methods有什么区别？.html.21acdb85.js" as="script" /><link rel="prefetch" href="/onlineBlog/assets/09.事件有哪些修饰符？.html.bfa40e43.js" as="script" /><link rel="prefetch" href="/onlineBlog/assets/10.transition.html.5ad21845.js" as="script" /><link rel="prefetch" href="/onlineBlog/assets/11.assets和static的区别.html.26c447b1.js" as="script" /><link rel="prefetch" href="/onlineBlog/assets/12.Vue中性能优化.html.31bba2f3.js" as="script" /><link rel="prefetch" href="/onlineBlog/assets/13.优化首屏加载.html.10b467a1.js" as="script" /><link rel="prefetch" href="/onlineBlog/assets/14.Vue初始化页面闪动问题.html.353afe95.js" as="script" /><link rel="prefetch" href="/onlineBlog/assets/15.Vue是如何实现响应式数据的1.html.95772fcf.js" as="script" /><link rel="prefetch" href="/onlineBlog/assets/16.Vue是如何监听数组的变化1.html.596f0ea6.js" as="script" /><link rel="prefetch" href="/onlineBlog/assets/17.Vue的事件绑定原理1.html.c12852ad.js" as="script" /><link rel="prefetch" href="/onlineBlog/assets/18.v-model中的实现原理及如何自定义v-model1.html.6994c407.js" as="script" /><link rel="prefetch" href="/onlineBlog/assets/19.为什么Vue采用异步渲染1.html.36f15fe5.js" as="script" /><link rel="prefetch" href="/onlineBlog/assets/20.说说nextTick1.html.736d6249.js" as="script" /><link rel="prefetch" href="/onlineBlog/assets/21.Vue的生命周期.html.127cd934.js" as="script" /><link rel="prefetch" href="/onlineBlog/assets/22.父子组件生命周期调用顺序.html.c211e192.js" as="script" /><link rel="prefetch" href="/onlineBlog/assets/23.Vue组件通信1.html.597cd123.js" as="script" /><link rel="prefetch" href="/onlineBlog/assets/24.Vuex 工作原理1.html.be33983d.js" as="script" /><link rel="prefetch" href="/onlineBlog/assets/25.diff算法1.html.9ecf3286.js" as="script" /><link rel="prefetch" href="/onlineBlog/assets/26.v-if 和 v-show 区别1.html.d9231e2a.js" as="script" /><link rel="prefetch" href="/onlineBlog/assets/27.v-for和v-if为什么不能连用.html.197671e4.js" as="script" /><link rel="prefetch" href="/onlineBlog/assets/end.html.e8676c8d.js" as="script" /><link rel="prefetch" href="/onlineBlog/assets/1.html.8e0f9ecf.js" as="script" /><link rel="prefetch" href="/onlineBlog/assets/01.http.html.6279ef58.js" as="script" /><link rel="prefetch" href="/onlineBlog/assets/02.常见的状态码.html.714c6204.js" as="script" /><link rel="prefetch" href="/onlineBlog/assets/01.手写instanceof.html.9cb4e50b.js" as="script" /><link rel="prefetch" href="/onlineBlog/assets/02.手写Promise.html.4eb679a4.js" as="script" /><link rel="prefetch" href="/onlineBlog/assets/03.手写三种常见排序.html.f6134502.js" as="script" /><link rel="prefetch" href="/onlineBlog/assets/04.手写call_apply_bind.html.a6afb2e1.js" as="script" /><link rel="prefetch" href="/onlineBlog/assets/05.手写深拷贝.html.16bfdb5a.js" as="script" /><link rel="prefetch" href="/onlineBlog/assets/06.手写new.html.bdb6b3a7.js" as="script" /><link rel="prefetch" href="/onlineBlog/assets/07.手写XMLHttpRequest请求.html.b231984a.js" as="script" /><link rel="prefetch" href="/onlineBlog/assets/1.数据类型.html.1c1bba53.js" as="script" /><link rel="prefetch" href="/onlineBlog/assets/1.类型判断.html.febbf8bb.js" as="script" /><link rel="prefetch" href="/onlineBlog/assets/2.typeof.html.bcbebab4.js" as="script" /><link rel="prefetch" href="/onlineBlog/assets/3.instanceof.html.592a2e84.js" as="script" /><link rel="prefetch" href="/onlineBlog/assets/4.Object.prototype.toString.html.9491942b.js" as="script" /><link rel="prefetch" href="/onlineBlog/assets/1.执行上下文.html.4e508d33.js" as="script" /><link rel="prefetch" href="/onlineBlog/assets/1.作用域.html.22df41b5.js" as="script" /><link rel="prefetch" href="/onlineBlog/assets/01.说说闭包.html.aefe88d8.js" as="script" /><link rel="prefetch" href="/onlineBlog/assets/1.说说this.html.3b827846.js" as="script" /><link rel="prefetch" href="/onlineBlog/assets/04.手写call_apply_bind.html.48a40595.js" as="script" /><link rel="prefetch" href="/onlineBlog/assets/1.new.html.80b71628.js" as="script" /><link rel="prefetch" href="/onlineBlog/assets/继承.html.4cad860a.js" as="script" /><link rel="prefetch" href="/onlineBlog/assets/1.区分进程和线程.html.c3dfdf2d.js" as="script" /><link rel="prefetch" href="/onlineBlog/assets/2.浏览器中的进程.html.1690d0c1.js" as="script" /><link rel="prefetch" href="/onlineBlog/assets/3.事件循环.html.33f4f6dc.js" as="script" /><link rel="prefetch" href="/onlineBlog/assets/4.宏任务和微任务.html.328fc8bc.js" as="script" /><link rel="prefetch" href="/onlineBlog/assets/5.JS执行和DOM渲染的顺序.html.afa1bd34.js" as="script" /><link rel="prefetch" href="/onlineBlog/assets/事件循环相关的优质博客.html.c756b12c.js" as="script" /><link rel="prefetch" href="/onlineBlog/assets/performance.html.0b45b20d.js" as="script" /><link rel="prefetch" href="/onlineBlog/assets/内存泄露.html.d45ff8b2.js" as="script" /><link rel="prefetch" href="/onlineBlog/assets/压缩图片.html.484cc651.js" as="script" /><link rel="prefetch" href="/onlineBlog/assets/虚拟列表(待完善).html.422d1c3b.js" as="script" /><link rel="prefetch" href="/onlineBlog/assets/async awiat.html.abe81185.js" as="script" /><link rel="prefetch" href="/onlineBlog/assets/01.Promise基础知识.html.1ea87007.js" as="script" /><link rel="prefetch" href="/onlineBlog/assets/03.相关博客和资源.html.83df8cd5.js" as="script" /><link rel="prefetch" href="/onlineBlog/assets/1.XMLHttpRequest.html.a8155cd3.js" as="script" /><link rel="prefetch" href="/onlineBlog/assets/2.状态码.html.6257f284.js" as="script" /><link rel="prefetch" href="/onlineBlog/assets/3.请求头.html.3932c48c.js" as="script" /><link rel="prefetch" href="/onlineBlog/assets/4.http缓存(待完善).html.367a2c6b.js" as="script" /><link rel="prefetch" href="/onlineBlog/assets/5.地址栏输入URL到页面展现都经历了哪些过程.html.f7d3cd9d.js" as="script" /><link rel="prefetch" href="/onlineBlog/assets/1.nodejs中nodemon热更新原理.html.069b4164.js" as="script" /><link rel="prefetch" href="/onlineBlog/assets/2.webpack中的hmr热更新.html.792a7c1d.js" as="script" /><link rel="prefetch" href="/onlineBlog/assets/3.webpack基础配置.html.0d846abf.js" as="script" /><link rel="prefetch" href="/onlineBlog/assets/相关博客和资源.html.3c4870fe.js" as="script" /><link rel="prefetch" href="/onlineBlog/assets/1.为什么我复制的中文url粘贴出来会是乱码的？ 浏览器url编码和解码.html.e6ea3ab1.js" as="script" /><link rel="prefetch" href="/onlineBlog/assets/1.以.vue结尾的文件中的scoped.html.c48c5184.js" as="script" /><link rel="prefetch" href="/onlineBlog/assets/2.去除项目的console.html.0e901259.js" as="script" /><link rel="prefetch" href="/onlineBlog/assets/3.完全掌握vue中的_set.html.253f2d5a.js" as="script" /><link rel="prefetch" href="/onlineBlog/assets/4.时隔多年再学习Vuex，什么？原来如此简单!.html.6bc57bd2.js" as="script" /><link rel="prefetch" href="/onlineBlog/assets/5.有关Vuex的深度思考.html.0ce4a92c.js" as="script" /><link rel="prefetch" href="/onlineBlog/assets/6._forceUpdate对应源码是什么，到底如何生效的？.html.41c326a5.js" as="script" /><link rel="prefetch" href="/onlineBlog/assets/7.axios中如何实现取消请求.html.fcd4cd54.js" as="script" /><link rel="prefetch" href="/onlineBlog/assets/8.最新版axios@1.3.x取消请求--AbortController.html.30ab8699.js" as="script" /><link rel="prefetch" href="/onlineBlog/assets/9.基础组件库供主项目调用，如何处理-软链接.html.4a919b73.js" as="script" /><link rel="prefetch" href="/onlineBlog/assets/01.Pow(x_ n).html.4ba363b0.js" as="script" /><link rel="prefetch" href="/onlineBlog/assets/02.x的平方根.html.3bbb8ec9.js" as="script" /><link rel="prefetch" href="/onlineBlog/assets/03.二分查找.html.dba4217c.js" as="script" /><link rel="prefetch" href="/onlineBlog/assets/04.两数之和.html.a7284b30.js" as="script" /><link rel="prefetch" href="/onlineBlog/assets/05.找不同.html.8b9cce1d.js" as="script" /><link rel="prefetch" href="/onlineBlog/assets/06.两个数组的交集.html.3e581ae0.js" as="script" /><link rel="prefetch" href="/onlineBlog/assets/07.滑动窗口最大值.html.bfbfb624.js" as="script" /><link rel="prefetch" href="/onlineBlog/assets/辅助文档.html.fa2fcd0c.js" as="script" /><link rel="prefetch" href="/onlineBlog/assets/1.阅读-设计模式小册收获总结.html.a74ed725.js" as="script" /><link rel="prefetch" href="/onlineBlog/assets/404.html.c3e557d0.js" as="script" /><link rel="prefetch" href="/onlineBlog/assets/index.html.aad29663.js" as="script" /><link rel="prefetch" href="/onlineBlog/assets/index.html.109f6a86.js" as="script" /><link rel="prefetch" href="/onlineBlog/assets/index.html.7530fc27.js" as="script" /><link rel="prefetch" href="/onlineBlog/assets/index.html.f02c037a.js" as="script" /><link rel="prefetch" href="/onlineBlog/assets/如何发布一个属于自己的npm包.html.54a3b245.js" as="script" /><link rel="prefetch" href="/onlineBlog/assets/02.初步认识.html.3f20565b.js" as="script" /><link rel="prefetch" href="/onlineBlog/assets/03.下载安装.html.ee786478.js" as="script" /><link rel="prefetch" href="/onlineBlog/assets/04.HelloTypeScript.html.5fc6d866.js" as="script" /><link rel="prefetch" href="/onlineBlog/assets/05.数据类型.html.1ac9167e.js" as="script" /><link rel="prefetch" href="/onlineBlog/assets/06.数组的类型.html.44cc57ef.js" as="script" /><link rel="prefetch" href="/onlineBlog/assets/07.函数的类型.html.099a6509.js" as="script" /><link rel="prefetch" href="/onlineBlog/assets/08.类型断言.html.6eb324c5.js" as="script" /><link rel="prefetch" href="/onlineBlog/assets/1.readme.html.bfe41c8c.js" as="script" /><link rel="prefetch" href="/onlineBlog/assets/01.如何理解Html的语义化.html.da7f14c5.js" as="script" /><link rel="prefetch" href="/onlineBlog/assets/02.script标签中defer和async的区别.html.97938f14.js" as="script" /><link rel="prefetch" href="/onlineBlog/assets/03.从浏览器地址栏输入url到请求返回发生了什么.html.7c882a83.js" as="script" /><link rel="prefetch" href="/onlineBlog/assets/04.css盒子模型.html.f75a2a75.js" as="script" /><link rel="prefetch" href="/onlineBlog/assets/05.css选择器和优先级.html.337b8e2a.js" as="script" /><link rel="prefetch" href="/onlineBlog/assets/06.重排重绘.html.85b9ec72.js" as="script" /><link rel="prefetch" href="/onlineBlog/assets/07.对BFC的理解.html.7373ffc2.js" as="script" /><link rel="prefetch" href="/onlineBlog/assets/08.水平垂直居中多种实现方式.html.986e0549.js" as="script" /><link rel="prefetch" href="/onlineBlog/assets/09.line-height如何继承.html.ffab0e06.js" as="script" /><link rel="prefetch" href="/onlineBlog/assets/end.html.856325a9.js" as="script" /><link rel="prefetch" href="/onlineBlog/assets/01.说说闭包(高频).html.b039a658.js" as="script" /><link rel="prefetch" href="/onlineBlog/assets/02.说说箭头函数.html.6c678396.js" as="script" /><link rel="prefetch" href="/onlineBlog/assets/03.说说JS的模块化.html.92a3edd2.js" as="script" /><link rel="prefetch" href="/onlineBlog/assets/04.说说this.html.1db45e09.js" as="script" /><link rel="prefetch" href="/onlineBlog/assets/05.说说async和await.html.7735a859.js" as="script" /><link rel="prefetch" href="/onlineBlog/assets/06.说说Promise(待完善).html.d11b34a0.js" as="script" /><link rel="prefetch" href="/onlineBlog/assets/07.深拷贝和浅拷贝的区别(待完善).html.0486dddf.js" as="script" /><link rel="prefetch" href="/onlineBlog/assets/08.比较 typeof instanceof.html.3ae93a7a.js" as="script" /><link rel="prefetch" href="/onlineBlog/assets/09.构造函数、原型对象、实例对象三者关系.html.1c4c44cd.js" as="script" /><link rel="prefetch" href="/onlineBlog/assets/10.数组的forEach、map、every、some、filter区别？.html.780bc014.js" as="script" /><link rel="prefetch" href="/onlineBlog/assets/11.怎么理解宏任务和微任务的(待完善).html.636ebdcb.js" as="script" /><link rel="prefetch" href="/onlineBlog/assets/12.对象方法或者属性的查找规则是怎样的？.html.8975af53.js" as="script" /><link rel="prefetch" href="/onlineBlog/assets/13.什么是高阶函数.html.821b05f9.js" as="script" /><link rel="prefetch" href="/onlineBlog/assets/14.什么是原型链.html.5178fa33.js" as="script" /><link rel="prefetch" href="/onlineBlog/assets/15.ES6新特性.html.2cc2d840.js" as="script" /><link rel="prefetch" href="/onlineBlog/assets/16.let、const、var关键字的区别.html.8bebc83a.js" as="script" /><link rel="prefetch" href="/onlineBlog/assets/17.JS中数组的常见方法.html.b2bf4b15.js" as="script" /><link rel="prefetch" href="/onlineBlog/assets/18.JS中创建对象的几种方式(待完善).html.0b96e6a1.js" as="script" /><link rel="prefetch" href="/onlineBlog/assets/19.JS中字符串的常见方法(待完善).html.e6619416.js" as="script" /><link rel="prefetch" href="/onlineBlog/assets/20.说说export和export default的区别.html.743235d2.js" as="script" /><link rel="prefetch" href="/onlineBlog/assets/21.说说call_apply_bind(待完善).html.28944cb2.js" as="script" /><link rel="prefetch" href="/onlineBlog/assets/22.谈谈垃圾回收机制及内存管理.html.77bf8df2.js" as="script" /><link rel="prefetch" href="/onlineBlog/assets/23.说说ES6中的解构.html.bd833419.js" as="script" /><link rel="prefetch" href="/onlineBlog/assets/24.说说构造函数原型 prototype.html.8f1de458.js" as="script" /><link rel="prefetch" href="/onlineBlog/assets/25.说说对象原型__proto__.html.9ee503e5.js" as="script" /><link rel="prefetch" href="/onlineBlog/assets/26.JS中的继承(待完善).html.a4480218.js" as="script" /><link rel="prefetch" href="/onlineBlog/assets/27.手写深拷贝.html.a549566b.js" as="script" /><link rel="prefetch" href="/onlineBlog/assets/28.0.1_0.2不等于0.3.html.c363d726.js" as="script" /><link rel="prefetch" href="/onlineBlog/assets/29.new.html.b995c877.js" as="script" /><link rel="prefetch" href="/onlineBlog/assets/30.cookie_localStorage_sessionStorage.html.8ec8372a.js" as="script" /><link rel="prefetch" href="/onlineBlog/assets/31.跨域.html.9d97dcef.js" as="script" /><link rel="prefetch" href="/onlineBlog/assets/end.html.fc63b04d.js" as="script" /><link rel="prefetch" href="/onlineBlog/assets/1.html.5e69032c.js" as="script" /><link rel="prefetch" href="/onlineBlog/assets/1.html.3d86fbe7.js" as="script" /><link rel="prefetch" href="/onlineBlog/assets/1.html.2581e0bf.js" as="script" /><link rel="prefetch" href="/onlineBlog/assets/01.vue中路由传参.html.ac7f695b.js" as="script" /><link rel="prefetch" href="/onlineBlog/assets/02.谈谈你对导航守卫的了解.html.0280d2ee.js" as="script" /><link rel="prefetch" href="/onlineBlog/assets/03.谈谈你对MVVM的理解.html.300b9ecd.js" as="script" /><link rel="prefetch" href="/onlineBlog/assets/04.说说vue中的生命周期钩子.html.cacb28a6.js" as="script" /><link rel="prefetch" href="/onlineBlog/assets/05.说说Vue的优点.html.94adf845.js" as="script" /><link rel="prefetch" href="/onlineBlog/assets/06.data为什么是一个函数？.html.7a2fed18.js" as="script" /><link rel="prefetch" href="/onlineBlog/assets/07._.sync_的作用是什么？.html.7045bdd6.js" as="script" /><link rel="prefetch" href="/onlineBlog/assets/08.computed和watch，methods有什么区别？.html.c36c75c9.js" as="script" /><link rel="prefetch" href="/onlineBlog/assets/09.事件有哪些修饰符？.html.b96c2213.js" as="script" /><link rel="prefetch" href="/onlineBlog/assets/10.transition.html.f8a8ec48.js" as="script" /><link rel="prefetch" href="/onlineBlog/assets/11.assets和static的区别.html.8ca82281.js" as="script" /><link rel="prefetch" href="/onlineBlog/assets/12.Vue中性能优化.html.b3cec1a5.js" as="script" /><link rel="prefetch" href="/onlineBlog/assets/13.优化首屏加载.html.26fe2efa.js" as="script" /><link rel="prefetch" href="/onlineBlog/assets/14.Vue初始化页面闪动问题.html.59ca7fc9.js" as="script" /><link rel="prefetch" href="/onlineBlog/assets/15.Vue是如何实现响应式数据的1.html.82c088c9.js" as="script" /><link rel="prefetch" href="/onlineBlog/assets/16.Vue是如何监听数组的变化1.html.9519a8e0.js" as="script" /><link rel="prefetch" href="/onlineBlog/assets/17.Vue的事件绑定原理1.html.63573ceb.js" as="script" /><link rel="prefetch" href="/onlineBlog/assets/18.v-model中的实现原理及如何自定义v-model1.html.88469404.js" as="script" /><link rel="prefetch" href="/onlineBlog/assets/19.为什么Vue采用异步渲染1.html.9850aee7.js" as="script" /><link rel="prefetch" href="/onlineBlog/assets/20.说说nextTick1.html.693adf53.js" as="script" /><link rel="prefetch" href="/onlineBlog/assets/21.Vue的生命周期.html.8aa0ed67.js" as="script" /><link rel="prefetch" href="/onlineBlog/assets/22.父子组件生命周期调用顺序.html.6960c891.js" as="script" /><link rel="prefetch" href="/onlineBlog/assets/23.Vue组件通信1.html.bfdc7c03.js" as="script" /><link rel="prefetch" href="/onlineBlog/assets/24.Vuex 工作原理1.html.0d0c98b8.js" as="script" /><link rel="prefetch" href="/onlineBlog/assets/25.diff算法1.html.ac626851.js" as="script" /><link rel="prefetch" href="/onlineBlog/assets/26.v-if 和 v-show 区别1.html.720f4ac1.js" as="script" /><link rel="prefetch" href="/onlineBlog/assets/27.v-for和v-if为什么不能连用.html.407706e5.js" as="script" /><link rel="prefetch" href="/onlineBlog/assets/end.html.aeb04e1b.js" as="script" /><link rel="prefetch" href="/onlineBlog/assets/1.html.4d004fe8.js" as="script" /><link rel="prefetch" href="/onlineBlog/assets/01.http.html.f94d4ec8.js" as="script" /><link rel="prefetch" href="/onlineBlog/assets/02.常见的状态码.html.12a393ac.js" as="script" /><link rel="prefetch" href="/onlineBlog/assets/01.手写instanceof.html.555f6e0c.js" as="script" /><link rel="prefetch" href="/onlineBlog/assets/02.手写Promise.html.ef6b121f.js" as="script" /><link rel="prefetch" href="/onlineBlog/assets/03.手写三种常见排序.html.70b71a68.js" as="script" /><link rel="prefetch" href="/onlineBlog/assets/04.手写call_apply_bind.html.a7bafa7a.js" as="script" /><link rel="prefetch" href="/onlineBlog/assets/05.手写深拷贝.html.61f9e802.js" as="script" /><link rel="prefetch" href="/onlineBlog/assets/06.手写new.html.9b5048f1.js" as="script" /><link rel="prefetch" href="/onlineBlog/assets/07.手写XMLHttpRequest请求.html.99316cf5.js" as="script" /><link rel="prefetch" href="/onlineBlog/assets/1.数据类型.html.fb416727.js" as="script" /><link rel="prefetch" href="/onlineBlog/assets/1.类型判断.html.27a7b254.js" as="script" /><link rel="prefetch" href="/onlineBlog/assets/2.typeof.html.487c37c5.js" as="script" /><link rel="prefetch" href="/onlineBlog/assets/3.instanceof.html.285b3c4a.js" as="script" /><link rel="prefetch" href="/onlineBlog/assets/4.Object.prototype.toString.html.2c501434.js" as="script" /><link rel="prefetch" href="/onlineBlog/assets/1.执行上下文.html.7f343f36.js" as="script" /><link rel="prefetch" href="/onlineBlog/assets/1.作用域.html.b7e8bafa.js" as="script" /><link rel="prefetch" href="/onlineBlog/assets/01.说说闭包.html.9d870793.js" as="script" /><link rel="prefetch" href="/onlineBlog/assets/1.说说this.html.3bd8050a.js" as="script" /><link rel="prefetch" href="/onlineBlog/assets/04.手写call_apply_bind.html.24a516fa.js" as="script" /><link rel="prefetch" href="/onlineBlog/assets/1.new.html.742bc991.js" as="script" /><link rel="prefetch" href="/onlineBlog/assets/继承.html.22c0aab0.js" as="script" /><link rel="prefetch" href="/onlineBlog/assets/1.区分进程和线程.html.65ea1326.js" as="script" /><link rel="prefetch" href="/onlineBlog/assets/2.浏览器中的进程.html.3f2fe3f2.js" as="script" /><link rel="prefetch" href="/onlineBlog/assets/3.事件循环.html.8df416cd.js" as="script" /><link rel="prefetch" href="/onlineBlog/assets/4.宏任务和微任务.html.d798e777.js" as="script" /><link rel="prefetch" href="/onlineBlog/assets/5.JS执行和DOM渲染的顺序.html.2ba1dabf.js" as="script" /><link rel="prefetch" href="/onlineBlog/assets/事件循环相关的优质博客.html.739022f1.js" as="script" /><link rel="prefetch" href="/onlineBlog/assets/performance.html.570b76b3.js" as="script" /><link rel="prefetch" href="/onlineBlog/assets/内存泄露.html.44fdb823.js" as="script" /><link rel="prefetch" href="/onlineBlog/assets/压缩图片.html.457c6d8a.js" as="script" /><link rel="prefetch" href="/onlineBlog/assets/虚拟列表(待完善).html.7f1be3aa.js" as="script" /><link rel="prefetch" href="/onlineBlog/assets/async awiat.html.1ae1ff79.js" as="script" /><link rel="prefetch" href="/onlineBlog/assets/01.Promise基础知识.html.a502c55c.js" as="script" /><link rel="prefetch" href="/onlineBlog/assets/03.相关博客和资源.html.26dbb28f.js" as="script" /><link rel="prefetch" href="/onlineBlog/assets/1.XMLHttpRequest.html.4490d038.js" as="script" /><link rel="prefetch" href="/onlineBlog/assets/2.状态码.html.a4fed1d0.js" as="script" /><link rel="prefetch" href="/onlineBlog/assets/3.请求头.html.d83768b8.js" as="script" /><link rel="prefetch" href="/onlineBlog/assets/4.http缓存(待完善).html.4f0b6742.js" as="script" /><link rel="prefetch" href="/onlineBlog/assets/5.地址栏输入URL到页面展现都经历了哪些过程.html.36707a4e.js" as="script" /><link rel="prefetch" href="/onlineBlog/assets/1.nodejs中nodemon热更新原理.html.bb03fdeb.js" as="script" /><link rel="prefetch" href="/onlineBlog/assets/2.webpack中的hmr热更新.html.ad8707d1.js" as="script" /><link rel="prefetch" href="/onlineBlog/assets/3.webpack基础配置.html.055194ad.js" as="script" /><link rel="prefetch" href="/onlineBlog/assets/相关博客和资源.html.a335db27.js" as="script" /><link rel="prefetch" href="/onlineBlog/assets/1.为什么我复制的中文url粘贴出来会是乱码的？ 浏览器url编码和解码.html.1ec63d98.js" as="script" /><link rel="prefetch" href="/onlineBlog/assets/1.以.vue结尾的文件中的scoped.html.0c6b5285.js" as="script" /><link rel="prefetch" href="/onlineBlog/assets/2.去除项目的console.html.5527be3d.js" as="script" /><link rel="prefetch" href="/onlineBlog/assets/3.完全掌握vue中的_set.html.a25a7b0d.js" as="script" /><link rel="prefetch" href="/onlineBlog/assets/4.时隔多年再学习Vuex，什么？原来如此简单!.html.4e3b8d71.js" as="script" /><link rel="prefetch" href="/onlineBlog/assets/5.有关Vuex的深度思考.html.0b4bd93a.js" as="script" /><link rel="prefetch" href="/onlineBlog/assets/6._forceUpdate对应源码是什么，到底如何生效的？.html.87f3f43f.js" as="script" /><link rel="prefetch" href="/onlineBlog/assets/7.axios中如何实现取消请求.html.0c99cf3c.js" as="script" /><link rel="prefetch" href="/onlineBlog/assets/8.最新版axios@1.3.x取消请求--AbortController.html.bf3d5749.js" as="script" /><link rel="prefetch" href="/onlineBlog/assets/9.基础组件库供主项目调用，如何处理-软链接.html.c37567f8.js" as="script" /><link rel="prefetch" href="/onlineBlog/assets/01.Pow(x_ n).html.ef842782.js" as="script" /><link rel="prefetch" href="/onlineBlog/assets/02.x的平方根.html.7107269e.js" as="script" /><link rel="prefetch" href="/onlineBlog/assets/03.二分查找.html.dfbb968d.js" as="script" /><link rel="prefetch" href="/onlineBlog/assets/04.两数之和.html.efb41413.js" as="script" /><link rel="prefetch" href="/onlineBlog/assets/05.找不同.html.031af655.js" as="script" /><link rel="prefetch" href="/onlineBlog/assets/06.两个数组的交集.html.1696d41c.js" as="script" /><link rel="prefetch" href="/onlineBlog/assets/07.滑动窗口最大值.html.f6549d30.js" as="script" /><link rel="prefetch" href="/onlineBlog/assets/辅助文档.html.825715ac.js" as="script" /><link rel="prefetch" href="/onlineBlog/assets/1.阅读-设计模式小册收获总结.html.46a578a8.js" as="script" /><link rel="prefetch" href="/onlineBlog/assets/404.html.f8cb479a.js" as="script" />
  </head>
  <body>
    <div id="app"><!--[--><div class="theme-container"><!--[--><header class="navbar"><div class="toggle-sidebar-button" title="toggle sidebar" aria-expanded="false" role="button" tabindex="0"><div class="icon" aria-hidden="true"><span></span><span></span><span></span></div></div><span><a href="/onlineBlog/" class=""><img class="logo" src="/onlineBlog/images/logo.png" alt="tomato"><span class="site-name can-hide">tomato</span></a></span><div class="navbar-items-wrapper" style=""><!--[--><!--]--><nav class="navbar-items can-hide"><!--[--><div class="navbar-item"><a href="/onlineBlog/group/" class="" aria-label="成长"><!--[--><!--]--> 成长 <!--[--><!--]--></a></div><div class="navbar-item"><a href="/onlineBlog/up/" class="router-link-active" aria-label="变秃了也变强了"><!--[--><!--]--> 变秃了也变强了 <!--[--><!--]--></a></div><div class="navbar-item"><a class="external-link" href="https://github.com/lazy-tomato/online" rel="noopener noreferrer" target="_blank" aria-label="Github"><!--[--><!--]--> Github <span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span><!--[--><!--]--></a></div><!--]--></nav><!--[--><!--]--><button class="toggle-color-mode-button" title="toggle color mode"><svg style="" class="icon" focusable="false" viewBox="0 0 32 32"><path d="M16 12.005a4 4 0 1 1-4 4a4.005 4.005 0 0 1 4-4m0-2a6 6 0 1 0 6 6a6 6 0 0 0-6-6z" fill="currentColor"></path><path d="M5.394 6.813l1.414-1.415l3.506 3.506L8.9 10.318z" fill="currentColor"></path><path d="M2 15.005h5v2H2z" fill="currentColor"></path><path d="M5.394 25.197L8.9 21.691l1.414 1.415l-3.506 3.505z" fill="currentColor"></path><path d="M15 25.005h2v5h-2z" fill="currentColor"></path><path d="M21.687 23.106l1.414-1.415l3.506 3.506l-1.414 1.414z" fill="currentColor"></path><path d="M25 15.005h5v2h-5z" fill="currentColor"></path><path d="M21.687 8.904l3.506-3.506l1.414 1.415l-3.506 3.505z" fill="currentColor"></path><path d="M15 2.005h2v5h-2z" fill="currentColor"></path></svg><svg style="display:none;" class="icon" focusable="false" viewBox="0 0 32 32"><path d="M13.502 5.414a15.075 15.075 0 0 0 11.594 18.194a11.113 11.113 0 0 1-7.975 3.39c-.138 0-.278.005-.418 0a11.094 11.094 0 0 1-3.2-21.584M14.98 3a1.002 1.002 0 0 0-.175.016a13.096 13.096 0 0 0 1.825 25.981c.164.006.328 0 .49 0a13.072 13.072 0 0 0 10.703-5.555a1.01 1.01 0 0 0-.783-1.565A13.08 13.08 0 0 1 15.89 4.38A1.015 1.015 0 0 0 14.98 3z" fill="currentColor"></path></svg></button><!----></div></header><!--]--><div class="sidebar-mask"></div><!--[--><aside class="sidebar"><nav class="navbar-items"><!--[--><div class="navbar-item"><a href="/onlineBlog/group/" class="" aria-label="成长"><!--[--><!--]--> 成长 <!--[--><!--]--></a></div><div class="navbar-item"><a href="/onlineBlog/up/" class="router-link-active" aria-label="变秃了也变强了"><!--[--><!--]--> 变秃了也变强了 <!--[--><!--]--></a></div><div class="navbar-item"><a class="external-link" href="https://github.com/lazy-tomato/online" rel="noopener noreferrer" target="_blank" aria-label="Github"><!--[--><!--]--> Github <span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span><!--[--><!--]--></a></div><!--]--></nav><!--[--><!--]--><ul class="sidebar-items"><!--[--><li><p tabindex="0" class="sidebar-item sidebar-heading collapsible">01.数据类型 <span class="right arrow"></span></p><ul style="display:none;" class="sidebar-item-children"><!--[--><li><a href="/onlineBlog/up/01.数据类型/1.数据类型.md" class="sidebar-item" aria-label="1.数据类型"><!--[--><!--]--> 1.数据类型 <!--[--><!--]--></a><!----></li><!--]--></ul></li><li><p tabindex="0" class="sidebar-item sidebar-heading collapsible">02.类型判断 <span class="right arrow"></span></p><ul style="display:none;" class="sidebar-item-children"><!--[--><li><a href="/onlineBlog/up/02.类型判断/1.类型判断.md" class="sidebar-item" aria-label="1.类型判断"><!--[--><!--]--> 1.类型判断 <!--[--><!--]--></a><!----></li><li><a href="/onlineBlog/up/02.类型判断/2.typeof.md" class="sidebar-item" aria-label="2.typeof"><!--[--><!--]--> 2.typeof <!--[--><!--]--></a><!----></li><li><a href="/onlineBlog/up/02.类型判断/3.instanceof.md" class="sidebar-item" aria-label="3.instanceof"><!--[--><!--]--> 3.instanceof <!--[--><!--]--></a><!----></li><li><a href="/onlineBlog/up/02.类型判断/4.Object.prototype.toString.md" class="sidebar-item" aria-label="4.Object.prototype.toString"><!--[--><!--]--> 4.Object.prototype.toString <!--[--><!--]--></a><!----></li><!--]--></ul></li><li><p tabindex="0" class="sidebar-item sidebar-heading collapsible">03.类型转换 <span class="right arrow"></span></p><!----></li><li><p tabindex="0" class="sidebar-item sidebar-heading collapsible">04.原型 <span class="right arrow"></span></p><!----></li><li><p tabindex="0" class="sidebar-item sidebar-heading collapsible">05.执行上下文 <span class="right arrow"></span></p><ul style="display:none;" class="sidebar-item-children"><!--[--><li><a href="/onlineBlog/up/05.执行上下文/1.执行上下文.md" class="sidebar-item" aria-label="1.执行上下文"><!--[--><!--]--> 1.执行上下文 <!--[--><!--]--></a><!----></li><!--]--></ul></li><li><p tabindex="0" class="sidebar-item sidebar-heading collapsible">06.作用域 <span class="right arrow"></span></p><ul style="display:none;" class="sidebar-item-children"><!--[--><li><a href="/onlineBlog/up/06.作用域/1.作用域.md" class="sidebar-item" aria-label="1.作用域"><!--[--><!--]--> 1.作用域 <!--[--><!--]--></a><!----></li><!--]--></ul></li><li><p tabindex="0" class="sidebar-item sidebar-heading collapsible">07.闭包 <span class="right arrow"></span></p><ul style="display:none;" class="sidebar-item-children"><!--[--><li><a href="/onlineBlog/up/07.闭包/01.说说闭包.md" class="sidebar-item" aria-label="01.说说闭包"><!--[--><!--]--> 01.说说闭包 <!--[--><!--]--></a><!----></li><!--]--></ul></li><li><p tabindex="0" class="sidebar-item sidebar-heading collapsible">08.this <span class="right arrow"></span></p><ul style="display:none;" class="sidebar-item-children"><!--[--><li><a href="/onlineBlog/up/08.this/1.说说this.md" class="sidebar-item" aria-label="1.说说this"><!--[--><!--]--> 1.说说this <!--[--><!--]--></a><!----></li><!--]--></ul></li><li><p tabindex="0" class="sidebar-item sidebar-heading collapsible">09.call，apply，bind实现 <span class="right arrow"></span></p><ul style="display:none;" class="sidebar-item-children"><!--[--><li><a href="/onlineBlog/up/09.call，apply，bind实现/04.手写call,apply,bind.md" class="sidebar-item" aria-label="04.手写call,apply,bind"><!--[--><!--]--> 04.手写call,apply,bind <!--[--><!--]--></a><!----></li><!--]--></ul></li><li><p tabindex="0" class="sidebar-item sidebar-heading collapsible">10.new <span class="right arrow"></span></p><ul style="display:none;" class="sidebar-item-children"><!--[--><li><a href="/onlineBlog/up/10.new/1.new.md" class="sidebar-item" aria-label="1.new"><!--[--><!--]--> 1.new <!--[--><!--]--></a><!----></li><!--]--></ul></li><li><p tabindex="0" class="sidebar-item sidebar-heading collapsible">11.class <span class="right arrow"></span></p><!----></li><li><p tabindex="0" class="sidebar-item sidebar-heading collapsible">12.继承 <span class="right arrow"></span></p><ul style="display:none;" class="sidebar-item-children"><!--[--><li><a href="/onlineBlog/up/12.继承/继承.md" class="sidebar-item" aria-label="继承"><!--[--><!--]--> 继承 <!--[--><!--]--></a><!----></li><!--]--></ul></li><li><p tabindex="0" class="sidebar-item sidebar-heading collapsible">13.迭代器和生成器 <span class="right arrow"></span></p><!----></li><li><p tabindex="0" class="sidebar-item sidebar-heading collapsible">14.模块化 <span class="right arrow"></span></p><!----></li><li><p tabindex="0" class="sidebar-item sidebar-heading active collapsible">15.事件循环 <span class="down arrow"></span></p><ul style="" class="sidebar-item-children"><!--[--><li><a href="/onlineBlog/up/15.事件循环/1.区分进程和线程.md" class="sidebar-item" aria-label="1.区分进程和线程"><!--[--><!--]--> 1.区分进程和线程 <!--[--><!--]--></a><!----></li><li><a href="/onlineBlog/up/15.事件循环/2.浏览器中的进程.md" class="sidebar-item" aria-label="2.浏览器中的进程"><!--[--><!--]--> 2.浏览器中的进程 <!--[--><!--]--></a><!----></li><li><a href="/onlineBlog/up/15.事件循环/3.事件循环.md" class="sidebar-item" aria-label="3.事件循环"><!--[--><!--]--> 3.事件循环 <!--[--><!--]--></a><!----></li><li><a href="/onlineBlog/up/15.事件循环/4.宏任务和微任务.md" class="sidebar-item" aria-label="4.宏任务和微任务"><!--[--><!--]--> 4.宏任务和微任务 <!--[--><!--]--></a><!----></li><li><a href="/onlineBlog/up/15.事件循环/5.JS执行和DOM渲染的顺序.md" class="sidebar-item" aria-label="5.JS执行和DOM渲染的顺序"><!--[--><!--]--> 5.JS执行和DOM渲染的顺序 <!--[--><!--]--></a><!----></li><li><a href="/onlineBlog/up/15.事件循环/6.vue中的nextTick.md" class="sidebar-item active" aria-label="6.vue中的nextTick"><!--[--><!--]--> 6.vue中的nextTick <!--[--><!--]--></a><!----></li><li><a href="/onlineBlog/up/15.事件循环/事件循环相关的优质博客.md" class="sidebar-item" aria-label="事件循环相关的优质博客"><!--[--><!--]--> 事件循环相关的优质博客 <!--[--><!--]--></a><!----></li><!--]--></ul></li><li><p tabindex="0" class="sidebar-item sidebar-heading collapsible">16.性能优化 <span class="right arrow"></span></p><ul style="display:none;" class="sidebar-item-children"><!--[--><li><a href="/onlineBlog/up/16.性能优化/performance.md" class="sidebar-item" aria-label="performance"><!--[--><!--]--> performance <!--[--><!--]--></a><!----></li><li><a href="/onlineBlog/up/16.性能优化/内存泄露.md" class="sidebar-item" aria-label="内存泄露"><!--[--><!--]--> 内存泄露 <!--[--><!--]--></a><!----></li><li><a href="/onlineBlog/up/16.性能优化/压缩图片.md" class="sidebar-item" aria-label="压缩图片"><!--[--><!--]--> 压缩图片 <!--[--><!--]--></a><!----></li><li><a href="/onlineBlog/up/16.性能优化/虚拟列表(待完善).md" class="sidebar-item" aria-label="虚拟列表(待完善)"><!--[--><!--]--> 虚拟列表(待完善) <!--[--><!--]--></a><!----></li><!--]--></ul></li><li><p tabindex="0" class="sidebar-item sidebar-heading collapsible">17.async和await <span class="right arrow"></span></p><ul style="display:none;" class="sidebar-item-children"><!--[--><li><a href="/onlineBlog/up/17.async和await/async awiat.md" class="sidebar-item" aria-label="async awiat"><!--[--><!--]--> async awiat <!--[--><!--]--></a><!----></li><!--]--></ul></li><li><p tabindex="0" class="sidebar-item sidebar-heading collapsible">18.Promise <span class="right arrow"></span></p><ul style="display:none;" class="sidebar-item-children"><!--[--><li><a href="/onlineBlog/up/18.Promise/01.Promise基础知识.md" class="sidebar-item" aria-label="01.Promise基础知识"><!--[--><!--]--> 01.Promise基础知识 <!--[--><!--]--></a><!----></li><li><a href="/onlineBlog/up/18.Promise/02.手写Promise.js" class="sidebar-item" aria-label="02.手写Promise.js"><!--[--><!--]--> 02.手写Promise.js <!--[--><!--]--></a><!----></li><li><a href="/onlineBlog/up/18.Promise/03.相关博客和资源.md" class="sidebar-item" aria-label="03.相关博客和资源"><!--[--><!--]--> 03.相关博客和资源 <!--[--><!--]--></a><!----></li><!--]--></ul></li><li><p tabindex="0" class="sidebar-item sidebar-heading collapsible">19.http <span class="right arrow"></span></p><ul style="display:none;" class="sidebar-item-children"><!--[--><li><a href="/onlineBlog/up/19.http/1.XMLHttpRequest.md" class="sidebar-item" aria-label="1.XMLHttpRequest"><!--[--><!--]--> 1.XMLHttpRequest <!--[--><!--]--></a><!----></li><li><a href="/onlineBlog/up/19.http/2.状态码.md" class="sidebar-item" aria-label="2.状态码"><!--[--><!--]--> 2.状态码 <!--[--><!--]--></a><!----></li><li><a href="/onlineBlog/up/19.http/3.请求头.md" class="sidebar-item" aria-label="3.请求头"><!--[--><!--]--> 3.请求头 <!--[--><!--]--></a><!----></li><li><a href="/onlineBlog/up/19.http/4.http缓存(待完善).md" class="sidebar-item" aria-label="4.http缓存(待完善)"><!--[--><!--]--> 4.http缓存(待完善) <!--[--><!--]--></a><!----></li><li><a href="/onlineBlog/up/19.http/5.地址栏输入URL到页面展现都经历了哪些过程.md" class="sidebar-item" aria-label="5.地址栏输入URL到页面展现都经历了哪些过程"><!--[--><!--]--> 5.地址栏输入URL到页面展现都经历了哪些过程 <!--[--><!--]--></a><!----></li><!--]--></ul></li><li><p tabindex="0" class="sidebar-item sidebar-heading collapsible">20.Webpack <span class="right arrow"></span></p><ul style="display:none;" class="sidebar-item-children"><!--[--><li><a href="/onlineBlog/up/20.Webpack/1.nodejs中nodemon热更新原理.md" class="sidebar-item" aria-label="1.nodejs中nodemon热更新原理"><!--[--><!--]--> 1.nodejs中nodemon热更新原理 <!--[--><!--]--></a><!----></li><li><a href="/onlineBlog/up/20.Webpack/2.webpack中的hmr热更新.md" class="sidebar-item" aria-label="2.webpack中的hmr热更新"><!--[--><!--]--> 2.webpack中的hmr热更新 <!--[--><!--]--></a><!----></li><li><a href="/onlineBlog/up/20.Webpack/3.webpack基础配置.md" class="sidebar-item" aria-label="3.webpack基础配置"><!--[--><!--]--> 3.webpack基础配置 <!--[--><!--]--></a><!----></li><li><a href="/onlineBlog/up/20.Webpack/相关博客和资源.md" class="sidebar-item" aria-label="相关博客和资源"><!--[--><!--]--> 相关博客和资源 <!--[--><!--]--></a><!----></li><!--]--></ul></li><li><p tabindex="0" class="sidebar-item sidebar-heading collapsible">21.Vue <span class="right arrow"></span></p><ul style="display:none;" class="sidebar-item-children"><!--[--><li><a href="/onlineBlog/up/21.Vue/1.以.vue结尾的文件中的scoped.md" class="sidebar-item" aria-label="1.以.vue结尾的文件中的scoped"><!--[--><!--]--> 1.以.vue结尾的文件中的scoped <!--[--><!--]--></a><!----></li><li><a href="/onlineBlog/up/21.Vue/2.去除项目的console.md" class="sidebar-item" aria-label="2.去除项目的console"><!--[--><!--]--> 2.去除项目的console <!--[--><!--]--></a><!----></li><li><a href="/onlineBlog/up/21.Vue/3.完全掌握vue中的$set.md" class="sidebar-item" aria-label="3.完全掌握vue中的$set"><!--[--><!--]--> 3.完全掌握vue中的$set <!--[--><!--]--></a><!----></li><li><a href="/onlineBlog/up/21.Vue/4.时隔多年再学习Vuex，什么？原来如此简单!.md" class="sidebar-item" aria-label="4.时隔多年再学习Vuex，什么？原来如此简单!"><!--[--><!--]--> 4.时隔多年再学习Vuex，什么？原来如此简单! <!--[--><!--]--></a><!----></li><li><a href="/onlineBlog/up/21.Vue/5.有关Vuex的深度思考.md" class="sidebar-item" aria-label="5.有关Vuex的深度思考"><!--[--><!--]--> 5.有关Vuex的深度思考 <!--[--><!--]--></a><!----></li><li><a href="/onlineBlog/up/21.Vue/6.$forceUpdate对应源码是什么，到底如何生效的？.md" class="sidebar-item" aria-label="6.$forceUpdate对应源码是什么，到底如何生效的？"><!--[--><!--]--> 6.$forceUpdate对应源码是什么，到底如何生效的？ <!--[--><!--]--></a><!----></li><li><a href="/onlineBlog/up/21.Vue/7.axios中如何实现取消请求.md" class="sidebar-item" aria-label="7.axios中如何实现取消请求"><!--[--><!--]--> 7.axios中如何实现取消请求 <!--[--><!--]--></a><!----></li><li><a href="/onlineBlog/up/21.Vue/8.最新版axios@1.3.x取消请求--AbortController.md" class="sidebar-item" aria-label="8.最新版axios@1.3.x取消请求--AbortController"><!--[--><!--]--> 8.最新版axios@1.3.x取消请求--AbortController <!--[--><!--]--></a><!----></li><li><a href="/onlineBlog/up/21.Vue/9.基础组件库供主项目调用，如何处理-软链接.md" class="sidebar-item" aria-label="9.基础组件库供主项目调用，如何处理-软链接"><!--[--><!--]--> 9.基础组件库供主项目调用，如何处理-软链接 <!--[--><!--]--></a><!----></li><!--]--></ul></li><li><p tabindex="0" class="sidebar-item sidebar-heading collapsible">22.javascript相关 <span class="right arrow"></span></p><ul style="display:none;" class="sidebar-item-children"><!--[--><li><a href="/onlineBlog/up/22.javascript相关/1.为什么我复制的中文url粘贴出来会是乱码的？ 浏览器url编码和解码.md" class="sidebar-item" aria-label="1.为什么我复制的中文url粘贴出来会是乱码的？ 浏览器url编码和解码"><!--[--><!--]--> 1.为什么我复制的中文url粘贴出来会是乱码的？ 浏览器url编码和解码 <!--[--><!--]--></a><!----></li><!--]--></ul></li><li><p tabindex="0" class="sidebar-item sidebar-heading collapsible">React <span class="right arrow"></span></p><!----></li><li><p tabindex="0" class="sidebar-item sidebar-heading collapsible">vite <span class="right arrow"></span></p><!----></li><li><p tabindex="0" class="sidebar-item sidebar-heading collapsible">算法 <span class="right arrow"></span></p><ul style="display:none;" class="sidebar-item-children"><!--[--><li><a href="/onlineBlog/up/算法/01.Pow(x, n).md" class="sidebar-item" aria-label="01.Pow(x, n)"><!--[--><!--]--> 01.Pow(x, n) <!--[--><!--]--></a><!----></li><li><a href="/onlineBlog/up/算法/02.x的平方根.md" class="sidebar-item" aria-label="02.x的平方根"><!--[--><!--]--> 02.x的平方根 <!--[--><!--]--></a><!----></li><li><a href="/onlineBlog/up/算法/03.二分查找.md" class="sidebar-item" aria-label="03.二分查找"><!--[--><!--]--> 03.二分查找 <!--[--><!--]--></a><!----></li><li><a href="/onlineBlog/up/算法/04.两数之和.md" class="sidebar-item" aria-label="04.两数之和"><!--[--><!--]--> 04.两数之和 <!--[--><!--]--></a><!----></li><li><a href="/onlineBlog/up/算法/05.找不同.md" class="sidebar-item" aria-label="05.找不同"><!--[--><!--]--> 05.找不同 <!--[--><!--]--></a><!----></li><li><a href="/onlineBlog/up/算法/06.两个数组的交集.md" class="sidebar-item" aria-label="06.两个数组的交集"><!--[--><!--]--> 06.两个数组的交集 <!--[--><!--]--></a><!----></li><li><a href="/onlineBlog/up/算法/07.滑动窗口最大值.md" class="sidebar-item" aria-label="07.滑动窗口最大值"><!--[--><!--]--> 07.滑动窗口最大值 <!--[--><!--]--></a><!----></li><li><a href="/onlineBlog/up/算法/辅助文档.md" class="sidebar-item" aria-label="辅助文档"><!--[--><!--]--> 辅助文档 <!--[--><!--]--></a><!----></li><!--]--></ul></li><li><p tabindex="0" class="sidebar-item sidebar-heading collapsible">设计模式 <span class="right arrow"></span></p><ul style="display:none;" class="sidebar-item-children"><!--[--><li><a href="/onlineBlog/up/设计模式/1.阅读-设计模式小册收获总结.md" class="sidebar-item" aria-label="1.阅读-设计模式小册收获总结"><!--[--><!--]--> 1.阅读-设计模式小册收获总结 <!--[--><!--]--></a><!----></li><!--]--></ul></li><!--]--></ul><!--[--><!--]--></aside><!--]--><!--[--><main class="page"><!--[--><!--]--><div class="theme-default-content"><!--[--><!--]--><div><h1 id="vue-中的-nexttick-番茄出品" tabindex="-1"><a class="header-anchor" href="#vue-中的-nexttick-番茄出品" aria-hidden="true">#</a> Vue 中的 nextTick__番茄出品</h1><h2 id="start" tabindex="-1"><a class="header-anchor" href="#start" aria-hidden="true">#</a> start</h2><ul><li><p>本篇文章，将由浅入深的学习 Vue 中的 <strong><code>nextTick</code></strong> 。</p><blockquote><p>本文列举的案例，主要以 vue@2.6.11 为主</p></blockquote></li><li><p>作者：<code>lazy_tomato</code></p></li></ul><h2 id="_1-一个简单的任务场景" tabindex="-1"><a class="header-anchor" href="#_1-一个简单的任务场景" aria-hidden="true">#</a> 1. 一个简单的任务场景</h2><p>一切的起源，要从一个简单的问题开始，我很久以前编写了如下代码：</p><div class="language-html line-numbers-mode" data-ext="html"><pre class="language-html"><code><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>template</span><span class="token punctuation">&gt;</span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>app<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>tomato<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>{{ name }}<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">&gt;</span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>template</span><span class="token punctuation">&gt;</span></span>

<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>script</span><span class="token punctuation">&gt;</span></span><span class="token script"><span class="token language-javascript">
  <span class="token keyword">export</span> <span class="token keyword">default</span> <span class="token punctuation">{</span>
    <span class="token function">data</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token keyword">return</span> <span class="token punctuation">{</span>
        <span class="token literal-property property">name</span><span class="token operator">:</span> <span class="token string">&#39;lazy&#39;</span><span class="token punctuation">,</span>
      <span class="token punctuation">}</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token function">mounted</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>
        <span class="token string">&#39;初始输出：&#39;</span><span class="token punctuation">,</span>
        document<span class="token punctuation">.</span><span class="token function">getElementById</span><span class="token punctuation">(</span><span class="token string">&#39;tomato&#39;</span><span class="token punctuation">)</span><span class="token punctuation">.</span>innerText<span class="token punctuation">,</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span>name
      <span class="token punctuation">)</span>

      <span class="token keyword">this</span><span class="token punctuation">.</span>name <span class="token operator">=</span> <span class="token string">&#39;番茄&#39;</span>

      console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>
        <span class="token string">&#39;修改完name的输出：&#39;</span><span class="token punctuation">,</span>
        document<span class="token punctuation">.</span><span class="token function">getElementById</span><span class="token punctuation">(</span><span class="token string">&#39;tomato&#39;</span><span class="token punctuation">)</span><span class="token punctuation">.</span>innerText<span class="token punctuation">,</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span>name
      <span class="token punctuation">)</span>

      <span class="token comment">// 初始输出： lazy lazy</span>
      <span class="token comment">// 修改完name的输出： lazy 番茄</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token punctuation">}</span>
</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>script</span><span class="token punctuation">&gt;</span></span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>简单说明一下上述代码逻辑：当页面加载完毕后，我修改了 <code>data</code> 中的数据。然后立即获取对应 DOM 中的内容，DOM 中的内容并不是最新的。</p><p><img src="/onlineBlog/assets/image-20221212172537897.29fde54e.png" alt="图1"></p><p><em>为什么修改了数据，立即获取 DOM 中的内容，并不是最新的？</em></p><h2 id="_2-猜测问题原因" tabindex="-1"><a class="header-anchor" href="#_2-猜测问题原因" aria-hidden="true">#</a> 2. 猜测问题原因</h2><p>虽然打印的数据是<strong>旧的数据</strong>，但是可以看到上方的截图（图 1），页面显示的是番茄（<strong>新的数据</strong>）。</p><p><strong>我猜测问题的原因：可能是因为修改数据到更新 dom，这一步需要一定的时间。</strong></p><p>好的，我加一个定时器，直接等待 5s，再去获取 DOM 的内容，验证我自己的猜想。</p><div class="language-html line-numbers-mode" data-ext="html"><pre class="language-html"><code><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>template</span><span class="token punctuation">&gt;</span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>app<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>tomato<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>{{ name }}<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">&gt;</span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>template</span><span class="token punctuation">&gt;</span></span>

<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>script</span><span class="token punctuation">&gt;</span></span><span class="token script"><span class="token language-javascript">
  <span class="token keyword">export</span> <span class="token keyword">default</span> <span class="token punctuation">{</span>
    <span class="token function">data</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token keyword">return</span> <span class="token punctuation">{</span>
        <span class="token literal-property property">name</span><span class="token operator">:</span> <span class="token string">&#39;lazy&#39;</span><span class="token punctuation">,</span>
      <span class="token punctuation">}</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token function">mounted</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>
        <span class="token string">&#39;初始输出：&#39;</span><span class="token punctuation">,</span>
        document<span class="token punctuation">.</span><span class="token function">getElementById</span><span class="token punctuation">(</span><span class="token string">&#39;tomato&#39;</span><span class="token punctuation">)</span><span class="token punctuation">.</span>innerText<span class="token punctuation">,</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span>name
      <span class="token punctuation">)</span>

      <span class="token keyword">this</span><span class="token punctuation">.</span>name <span class="token operator">=</span> <span class="token string">&#39;番茄&#39;</span>

      <span class="token function">setTimeout</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
        console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>
          <span class="token string">&#39;修改完name的输出：&#39;</span><span class="token punctuation">,</span>
          document<span class="token punctuation">.</span><span class="token function">getElementById</span><span class="token punctuation">(</span><span class="token string">&#39;tomato&#39;</span><span class="token punctuation">)</span><span class="token punctuation">.</span>innerText<span class="token punctuation">,</span>
          <span class="token keyword">this</span><span class="token punctuation">.</span>name
        <span class="token punctuation">)</span>
      <span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token number">5000</span><span class="token punctuation">)</span>

      <span class="token comment">// 初始输出： lazy lazy</span>
      <span class="token comment">// 修改完name的输出： 番茄 番茄</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token punctuation">}</span>
</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>script</span><span class="token punctuation">&gt;</span></span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p><img src="/onlineBlog/assets/image-20221212174237195.1ee6dfd0.png" alt="image-20221212174237195"></p><p>可以看到上述的截图，输出的内容是正确的。</p><p><strong>当我把定时器等待的时间，不断减少，直到为 <code>0</code>的时候，我发现获取的数据也是最新的</strong>，why？</p><div class="language-javascript line-numbers-mode" data-ext="js"><pre class="language-javascript"><code><span class="token function">setTimeout</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>
    <span class="token string">&#39;修改完name的输出：&#39;</span><span class="token punctuation">,</span>
    document<span class="token punctuation">.</span><span class="token function">getElementById</span><span class="token punctuation">(</span><span class="token string">&#39;tomato&#39;</span><span class="token punctuation">)</span><span class="token punctuation">.</span>innerText<span class="token punctuation">,</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span>name
  <span class="token punctuation">)</span>
<span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">)</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h2 id="_3-找寻问题的根源" tabindex="-1"><a class="header-anchor" href="#_3-找寻问题的根源" aria-hidden="true">#</a> 3. 找寻问题的根源</h2><p>上述的试验，并没有找到问题的根本原因。</p><p>为了彻底解决这个问题，我们阅读一下 Vue 的源码，一探究竟。</p><blockquote><p><strong>我当前案例运行的 Vue 版本为 <code>vue@2.6.11</code>，我就以此版本做详细说明。</strong></p></blockquote><p>有些前置逻辑，这里简单提一下，Vue2 响应式原理是借助 <code>Object.defineProperty()</code> 来实现的，当对象值被修改的时候，会依次触发以下函数：</p><div class="language-javascript line-numbers-mode" data-ext="js"><pre class="language-javascript"><code><span class="token comment">// notify =&gt; update =&gt; queueWatcher</span>

<span class="token comment">// 这里需要对响应式原理有一些掌握</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>对应案例中的代码。当我修改了<code>data</code> 中 <code>name</code> 的值，就会触发 <code>queueWatcher</code> 函数。</p><h2 id="_4-queuewatcher" tabindex="-1"><a class="header-anchor" href="#_4-queuewatcher" aria-hidden="true">#</a> 4. queueWatcher</h2><h3 id="_4-1-所在目录" tabindex="-1"><a class="header-anchor" href="#_4-1-所在目录" aria-hidden="true">#</a> 4.1 所在目录</h3><p><code>queueWatcher</code> 文件所在目录：<code>vue\src\core\observer\scheduler.ts</code></p><h3 id="_4-2-英文说明" tabindex="-1"><a class="header-anchor" href="#_4-2-英文说明" aria-hidden="true">#</a> 4.2 英文说明</h3><ul><li><code>scheduler</code>：调度程序</li><li><code>queue</code>：队列</li><li><code>Watcher</code>：观察者</li></ul><h3 id="_4-3-vue-源码中的-queuewatcher" tabindex="-1"><a class="header-anchor" href="#_4-3-vue-源码中的-queuewatcher" aria-hidden="true">#</a> 4.3 Vue 源码中的 queueWatcher</h3><div class="language-javascript line-numbers-mode" data-ext="js"><pre class="language-javascript"><code><span class="token doc-comment comment">/**
 * Push a watcher into the watcher queue.
 * Jobs with duplicate IDs will be skipped unless it&#39;s
 * pushed when the queue is being flushed.
 */</span>
<span class="token keyword">export</span> <span class="token keyword">function</span> <span class="token function">queueWatcher</span><span class="token punctuation">(</span><span class="token parameter"><span class="token literal-property property">watcher</span><span class="token operator">:</span> Watcher</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">const</span> id <span class="token operator">=</span> watcher<span class="token punctuation">.</span>id
  <span class="token keyword">if</span> <span class="token punctuation">(</span>has<span class="token punctuation">[</span>id<span class="token punctuation">]</span> <span class="token operator">!=</span> <span class="token keyword">null</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span>
  <span class="token punctuation">}</span>

  <span class="token keyword">if</span> <span class="token punctuation">(</span>watcher <span class="token operator">===</span> Dep<span class="token punctuation">.</span>target <span class="token operator">&amp;&amp;</span> watcher<span class="token punctuation">.</span>noRecurse<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span>
  <span class="token punctuation">}</span>

  has<span class="token punctuation">[</span>id<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token boolean">true</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>flushing<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    queue<span class="token punctuation">.</span><span class="token function">push</span><span class="token punctuation">(</span>watcher<span class="token punctuation">)</span>
  <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
    <span class="token comment">// if already flushing, splice the watcher based on its id</span>
    <span class="token comment">// if already past its id, it will be run next immediately.</span>
    <span class="token keyword">let</span> i <span class="token operator">=</span> queue<span class="token punctuation">.</span>length <span class="token operator">-</span> <span class="token number">1</span>
    <span class="token keyword">while</span> <span class="token punctuation">(</span>i <span class="token operator">&gt;</span> index <span class="token operator">&amp;&amp;</span> queue<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">.</span>id <span class="token operator">&gt;</span> watcher<span class="token punctuation">.</span>id<span class="token punctuation">)</span> <span class="token punctuation">{</span>
      i<span class="token operator">--</span>
    <span class="token punctuation">}</span>
    queue<span class="token punctuation">.</span><span class="token function">splice</span><span class="token punctuation">(</span>i <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> watcher<span class="token punctuation">)</span>
  <span class="token punctuation">}</span>
  <span class="token comment">// queue the flush</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>waiting<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    waiting <span class="token operator">=</span> <span class="token boolean">true</span>

    <span class="token keyword">if</span> <span class="token punctuation">(</span>__DEV__ <span class="token operator">&amp;&amp;</span> <span class="token operator">!</span>config<span class="token punctuation">.</span>async<span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token function">flushSchedulerQueue</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
      <span class="token keyword">return</span>
    <span class="token punctuation">}</span>
    <span class="token function">nextTick</span><span class="token punctuation">(</span>flushSchedulerQueue<span class="token punctuation">)</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="_4-4-简化后的-queuewatcher" tabindex="-1"><a class="header-anchor" href="#_4-4-简化后的-queuewatcher" aria-hidden="true">#</a> 4.4 简化后的 queueWatcher</h3><div class="language-javascript line-numbers-mode" data-ext="js"><pre class="language-javascript"><code><span class="token keyword">const</span> queue <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span>
<span class="token keyword">let</span> has <span class="token operator">=</span> <span class="token punctuation">{</span><span class="token punctuation">}</span>
<span class="token keyword">let</span> waiting <span class="token operator">=</span> <span class="token boolean">false</span>
<span class="token keyword">let</span> flushing <span class="token operator">=</span> <span class="token boolean">false</span>

<span class="token keyword">export</span> <span class="token keyword">function</span> <span class="token function">queueWatcher</span><span class="token punctuation">(</span><span class="token parameter">watcher</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">const</span> id <span class="token operator">=</span> watcher<span class="token punctuation">.</span>id
  has<span class="token punctuation">[</span>id<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token boolean">true</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>flushing<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    queue<span class="token punctuation">.</span><span class="token function">push</span><span class="token punctuation">(</span>watcher<span class="token punctuation">)</span>
  <span class="token punctuation">}</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>waiting<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    waiting <span class="token operator">=</span> <span class="token boolean">true</span>
    <span class="token function">nextTick</span><span class="token punctuation">(</span>flushSchedulerQueue<span class="token punctuation">)</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

<span class="token comment">// 上述代码就是简化后的代码</span>
<span class="token comment">// 简单来说，用一个数组存储存储了去重后的watcher。  (watcher可理解为是一个对象)</span>
<span class="token comment">// 然后执行 `nextTick(flushSchedulerQueue)`</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="_4-5-queuewatcher" tabindex="-1"><a class="header-anchor" href="#_4-5-queuewatcher" aria-hidden="true">#</a> 4.5 queueWatcher</h3><p><code>queueWatcher</code> 主要作用就是，存储了<strong>去重</strong>后的 <code>watcher</code>。也就是说，数据改变了并<strong>不会马上去渲染页面</strong>，而是先用一个数组缓存对应的 <code>watcher</code>。然后执行了 <code>nextTick(flushSchedulerQueue)</code></p><p><img src="/onlineBlog/assets/image-20221212231840901.656068da.png" alt="image-20221212231840901"></p><h2 id="_5-flushschedulerqueue" tabindex="-1"><a class="header-anchor" href="#_5-flushschedulerqueue" aria-hidden="true">#</a> 5. flushSchedulerQueue</h2><h3 id="_5-1-所在目录" tabindex="-1"><a class="header-anchor" href="#_5-1-所在目录" aria-hidden="true">#</a> 5.1 所在目录</h3><p><code>flushSchedulerQueue</code> 文件所在目录：<code>vue\src\core\observer\scheduler.ts</code></p><h3 id="_5-2-英文说明" tabindex="-1"><a class="header-anchor" href="#_5-2-英文说明" aria-hidden="true">#</a> 5.2 英文说明</h3><ul><li><code>flush</code>：刷新，冲刷</li><li><code>scheduler</code>：调度程序</li><li><code>queue</code>：队列</li></ul><h3 id="_5-3-vue-源码中的-flushschedulerqueue" tabindex="-1"><a class="header-anchor" href="#_5-3-vue-源码中的-flushschedulerqueue" aria-hidden="true">#</a> 5.3 Vue 源码中的 flushSchedulerQueue</h3><div class="language-javascript line-numbers-mode" data-ext="js"><pre class="language-javascript"><code><span class="token doc-comment comment">/**
 * Flush both queues and run the watchers.
 */</span>
<span class="token keyword">function</span> <span class="token function">flushSchedulerQueue</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  currentFlushTimestamp <span class="token operator">=</span> <span class="token function">getNow</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
  flushing <span class="token operator">=</span> <span class="token boolean">true</span>
  <span class="token keyword">let</span> watcher<span class="token punctuation">,</span> id

  <span class="token comment">// Sort queue before flush.</span>
  <span class="token comment">// This ensures that:</span>
  <span class="token comment">// 1. Components are updated from parent to child. (because parent is always</span>
  <span class="token comment">//    created before the child)</span>
  <span class="token comment">// 2. A component&#39;s user watchers are run before its render watcher (because</span>
  <span class="token comment">//    user watchers are created before the render watcher)</span>
  <span class="token comment">// 3. If a component is destroyed during a parent component&#39;s watcher run,</span>
  <span class="token comment">//    its watchers can be skipped.</span>
  queue<span class="token punctuation">.</span><span class="token function">sort</span><span class="token punctuation">(</span>sortCompareFn<span class="token punctuation">)</span>

  <span class="token comment">// do not cache length because more watchers might be pushed</span>
  <span class="token comment">// as we run existing watchers</span>
  <span class="token keyword">for</span> <span class="token punctuation">(</span>index <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> index <span class="token operator">&lt;</span> queue<span class="token punctuation">.</span>length<span class="token punctuation">;</span> index<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    watcher <span class="token operator">=</span> queue<span class="token punctuation">[</span>index<span class="token punctuation">]</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>watcher<span class="token punctuation">.</span>before<span class="token punctuation">)</span> <span class="token punctuation">{</span>
      watcher<span class="token punctuation">.</span><span class="token function">before</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token punctuation">}</span>
    id <span class="token operator">=</span> watcher<span class="token punctuation">.</span>id
    has<span class="token punctuation">[</span>id<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token keyword">null</span>
    watcher<span class="token punctuation">.</span><span class="token function">run</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token comment">// in dev build, check and stop circular updates.</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>__DEV__ <span class="token operator">&amp;&amp;</span> has<span class="token punctuation">[</span>id<span class="token punctuation">]</span> <span class="token operator">!=</span> <span class="token keyword">null</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      circular<span class="token punctuation">[</span>id<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token punctuation">(</span>circular<span class="token punctuation">[</span>id<span class="token punctuation">]</span> <span class="token operator">||</span> <span class="token number">0</span><span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token number">1</span>
      <span class="token keyword">if</span> <span class="token punctuation">(</span>circular<span class="token punctuation">[</span>id<span class="token punctuation">]</span> <span class="token operator">&gt;</span> <span class="token constant">MAX_UPDATE_COUNT</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token function">warn</span><span class="token punctuation">(</span>
          <span class="token string">&#39;You may have an infinite update loop &#39;</span> <span class="token operator">+</span>
            <span class="token punctuation">(</span>watcher<span class="token punctuation">.</span>user
              <span class="token operator">?</span> <span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">in watcher with expression &quot;</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>watcher<span class="token punctuation">.</span>expression<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">&quot;</span><span class="token template-punctuation string">`</span></span>
              <span class="token operator">:</span> <span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">in a component render function.</span><span class="token template-punctuation string">`</span></span><span class="token punctuation">)</span><span class="token punctuation">,</span>
          watcher<span class="token punctuation">.</span>vm
        <span class="token punctuation">)</span>
        <span class="token keyword">break</span>
      <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span>

  <span class="token comment">// keep copies of post queues before resetting state</span>
  <span class="token keyword">const</span> activatedQueue <span class="token operator">=</span> activatedChildren<span class="token punctuation">.</span><span class="token function">slice</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
  <span class="token keyword">const</span> updatedQueue <span class="token operator">=</span> queue<span class="token punctuation">.</span><span class="token function">slice</span><span class="token punctuation">(</span><span class="token punctuation">)</span>

  <span class="token function">resetSchedulerState</span><span class="token punctuation">(</span><span class="token punctuation">)</span>

  <span class="token comment">// call component updated and activated hooks</span>
  <span class="token function">callActivatedHooks</span><span class="token punctuation">(</span>activatedQueue<span class="token punctuation">)</span>
  <span class="token function">callUpdatedHooks</span><span class="token punctuation">(</span>updatedQueue<span class="token punctuation">)</span>
  <span class="token function">cleanupDeps</span><span class="token punctuation">(</span><span class="token punctuation">)</span>

  <span class="token comment">// devtool hook</span>
  <span class="token comment">/* istanbul ignore if */</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span>devtools <span class="token operator">&amp;&amp;</span> config<span class="token punctuation">.</span>devtools<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    devtools<span class="token punctuation">.</span><span class="token function">emit</span><span class="token punctuation">(</span><span class="token string">&#39;flush&#39;</span><span class="token punctuation">)</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="_5-4-简化后的-flushschedulerqueue" tabindex="-1"><a class="header-anchor" href="#_5-4-简化后的-flushschedulerqueue" aria-hidden="true">#</a> 5.4 简化后的 flushSchedulerQueue</h3><div class="language-javascript line-numbers-mode" data-ext="js"><pre class="language-javascript"><code><span class="token keyword">function</span> <span class="token function">flushSchedulerQueue</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  flushing <span class="token operator">=</span> <span class="token boolean">true</span>
  <span class="token keyword">let</span> watcher<span class="token punctuation">,</span> id

  queue<span class="token punctuation">.</span><span class="token function">sort</span><span class="token punctuation">(</span>sortCompareFn<span class="token punctuation">)</span>

  <span class="token keyword">for</span> <span class="token punctuation">(</span>index <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> index <span class="token operator">&lt;</span> queue<span class="token punctuation">.</span>length<span class="token punctuation">;</span> index<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    watcher <span class="token operator">=</span> queue<span class="token punctuation">[</span>index<span class="token punctuation">]</span>
    id <span class="token operator">=</span> watcher<span class="token punctuation">.</span>id
    has<span class="token punctuation">[</span>id<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token keyword">null</span>
    watcher<span class="token punctuation">.</span><span class="token function">run</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
  <span class="token punctuation">}</span>

  <span class="token function">resetSchedulerState</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token comment">// 重置一些变量</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="_5-5-说明" tabindex="-1"><a class="header-anchor" href="#_5-5-说明" aria-hidden="true">#</a> 5.5 说明</h3><p><code>flushSchedulerQueue</code> 英译过来可以理解为，<strong>刷新调度队列</strong>。</p><p>首先给 <code>queue</code> 排序，然后通过 for 循环，按顺序执行所有 <strong>watcher 的 run 方法</strong>。</p><p>注意这里的代码为： <code>nextTick(flushSchedulerQueue)</code>，<code>flushSchedulerQueue</code> 并没有立刻执行，是把 <code>flushSchedulerQueue</code> 这个函数以参数的形式传入 <code>nextTick</code>.</p><blockquote><ul><li><p><code>watcher.run()</code> 可以理解为就是重新渲染页面的方法，这个时候会去更新页面。</p></li><li><p><code>resetSchedulerState()</code> 这个函数主要包含：重置部分变量的逻辑。</p></li></ul></blockquote><h2 id="_6-nexttick" tabindex="-1"><a class="header-anchor" href="#_6-nexttick" aria-hidden="true">#</a> 6. nextTick</h2><h3 id="_6-1-所在目录" tabindex="-1"><a class="header-anchor" href="#_6-1-所在目录" aria-hidden="true">#</a> 6.1 所在目录</h3><p><code>nextTick</code> 文件所在目录：<code>vue\src\core\util\next-tick.ts</code></p><h3 id="_6-2-英文说明" tabindex="-1"><a class="header-anchor" href="#_6-2-英文说明" aria-hidden="true">#</a> 6.2 英文说明</h3><ul><li><code>next</code>：下一个</li><li><code>tick</code>：钩子</li></ul><h3 id="_6-3-vue-源码中的-nexttick" tabindex="-1"><a class="header-anchor" href="#_6-3-vue-源码中的-nexttick" aria-hidden="true">#</a> 6.3 Vue 源码中的 nextTick</h3><div class="language-javascript line-numbers-mode" data-ext="js"><pre class="language-javascript"><code><span class="token comment">/* globals MutationObserver */</span>

<span class="token keyword">import</span> <span class="token punctuation">{</span> noop <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">&#39;shared/util&#39;</span>
<span class="token keyword">import</span> <span class="token punctuation">{</span> handleError <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">&#39;./error&#39;</span>
<span class="token keyword">import</span> <span class="token punctuation">{</span> isIE<span class="token punctuation">,</span> isIOS<span class="token punctuation">,</span> isNative <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">&#39;./env&#39;</span>

<span class="token keyword">export</span> <span class="token keyword">let</span> isUsingMicroTask <span class="token operator">=</span> <span class="token boolean">false</span>

<span class="token keyword">const</span> <span class="token literal-property property">callbacks</span><span class="token operator">:</span> Array<span class="token operator">&lt;</span>Function<span class="token operator">&gt;</span> <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span>
<span class="token keyword">let</span> pending <span class="token operator">=</span> <span class="token boolean">false</span>

<span class="token keyword">function</span> <span class="token function">flushCallbacks</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  pending <span class="token operator">=</span> <span class="token boolean">false</span>
  <span class="token keyword">const</span> copies <span class="token operator">=</span> callbacks<span class="token punctuation">.</span><span class="token function">slice</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span>
  callbacks<span class="token punctuation">.</span>length <span class="token operator">=</span> <span class="token number">0</span>
  <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">let</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> copies<span class="token punctuation">.</span>length<span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    copies<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

<span class="token comment">// Here we have async deferring wrappers using microtasks.</span>
<span class="token comment">// In 2.5 we used (macro) tasks (in combination with microtasks).</span>
<span class="token comment">// However, it has subtle problems when state is changed right before repaint</span>
<span class="token comment">// (e.g. #6813, out-in transitions).</span>
<span class="token comment">// Also, using (macro) tasks in event handler would cause some weird behaviors</span>
<span class="token comment">// that cannot be circumvented (e.g. #7109, #7153, #7546, #7834, #8109).</span>
<span class="token comment">// So we now use microtasks everywhere, again.</span>
<span class="token comment">// A major drawback of this tradeoff is that there are some scenarios</span>
<span class="token comment">// where microtasks have too high a priority and fire in between supposedly</span>
<span class="token comment">// sequential events (e.g. #4521, #6690, which have workarounds)</span>
<span class="token comment">// or even between bubbling of the same event (#6566).</span>
<span class="token keyword">let</span> timerFunc

<span class="token comment">// The nextTick behavior leverages the microtask queue, which can be accessed</span>
<span class="token comment">// via either native Promise.then or MutationObserver.</span>
<span class="token comment">// MutationObserver has wider support, however it is seriously bugged in</span>
<span class="token comment">// UIWebView in iOS &gt;= 9.3.3 when triggered in touch event handlers. It</span>
<span class="token comment">// completely stops working after triggering a few times... so, if native</span>
<span class="token comment">// Promise is available, we will use it:</span>
<span class="token comment">/* istanbul ignore next, $flow-disable-line */</span>
<span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token keyword">typeof</span> Promise <span class="token operator">!==</span> <span class="token string">&#39;undefined&#39;</span> <span class="token operator">&amp;&amp;</span> <span class="token function">isNative</span><span class="token punctuation">(</span>Promise<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">const</span> p <span class="token operator">=</span> Promise<span class="token punctuation">.</span><span class="token function">resolve</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
  <span class="token function-variable function">timerFunc</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    p<span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span>flushCallbacks<span class="token punctuation">)</span>
    <span class="token comment">// In problematic UIWebViews, Promise.then doesn&#39;t completely break, but</span>
    <span class="token comment">// it can get stuck in a weird state where callbacks are pushed into the</span>
    <span class="token comment">// microtask queue but the queue isn&#39;t being flushed, until the browser</span>
    <span class="token comment">// needs to do some other work, e.g. handle a timer. Therefore we can</span>
    <span class="token comment">// &quot;force&quot; the microtask queue to be flushed by adding an empty timer.</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>isIOS<span class="token punctuation">)</span> <span class="token function">setTimeout</span><span class="token punctuation">(</span>noop<span class="token punctuation">)</span>
  <span class="token punctuation">}</span>
  isUsingMicroTask <span class="token operator">=</span> <span class="token boolean">true</span>
<span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token keyword">if</span> <span class="token punctuation">(</span>
  <span class="token operator">!</span>isIE <span class="token operator">&amp;&amp;</span>
  <span class="token keyword">typeof</span> MutationObserver <span class="token operator">!==</span> <span class="token string">&#39;undefined&#39;</span> <span class="token operator">&amp;&amp;</span>
  <span class="token punctuation">(</span><span class="token function">isNative</span><span class="token punctuation">(</span>MutationObserver<span class="token punctuation">)</span> <span class="token operator">||</span>
    <span class="token comment">// PhantomJS and iOS 7.x</span>
    MutationObserver<span class="token punctuation">.</span><span class="token function">toString</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">===</span> <span class="token string">&#39;[object MutationObserverConstructor]&#39;</span><span class="token punctuation">)</span>
<span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token comment">// Use MutationObserver where native Promise is not available,</span>
  <span class="token comment">// e.g. PhantomJS, iOS7, Android 4.4</span>
  <span class="token comment">// (#6466 MutationObserver is unreliable in IE11)</span>
  <span class="token keyword">let</span> counter <span class="token operator">=</span> <span class="token number">1</span>
  <span class="token keyword">const</span> observer <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">MutationObserver</span><span class="token punctuation">(</span>flushCallbacks<span class="token punctuation">)</span>
  <span class="token keyword">const</span> textNode <span class="token operator">=</span> document<span class="token punctuation">.</span><span class="token function">createTextNode</span><span class="token punctuation">(</span><span class="token function">String</span><span class="token punctuation">(</span>counter<span class="token punctuation">)</span><span class="token punctuation">)</span>
  observer<span class="token punctuation">.</span><span class="token function">observe</span><span class="token punctuation">(</span>textNode<span class="token punctuation">,</span> <span class="token punctuation">{</span>
    <span class="token literal-property property">characterData</span><span class="token operator">:</span> <span class="token boolean">true</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span>
  <span class="token function-variable function">timerFunc</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    counter <span class="token operator">=</span> <span class="token punctuation">(</span>counter <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">)</span> <span class="token operator">%</span> <span class="token number">2</span>
    textNode<span class="token punctuation">.</span>data <span class="token operator">=</span> <span class="token function">String</span><span class="token punctuation">(</span>counter<span class="token punctuation">)</span>
  <span class="token punctuation">}</span>
  isUsingMicroTask <span class="token operator">=</span> <span class="token boolean">true</span>
<span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token keyword">typeof</span> setImmediate <span class="token operator">!==</span> <span class="token string">&#39;undefined&#39;</span> <span class="token operator">&amp;&amp;</span> <span class="token function">isNative</span><span class="token punctuation">(</span>setImmediate<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token comment">// Fallback to setImmediate.</span>
  <span class="token comment">// Technically it leverages the (macro) task queue,</span>
  <span class="token comment">// but it is still a better choice than setTimeout.</span>
  <span class="token function-variable function">timerFunc</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    <span class="token function">setImmediate</span><span class="token punctuation">(</span>flushCallbacks<span class="token punctuation">)</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
  <span class="token comment">// Fallback to setTimeout.</span>
  <span class="token function-variable function">timerFunc</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    <span class="token function">setTimeout</span><span class="token punctuation">(</span>flushCallbacks<span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">)</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

<span class="token keyword">export</span> <span class="token keyword">function</span> <span class="token function">nextTick</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">:</span> Promise<span class="token operator">&lt;</span><span class="token keyword">void</span><span class="token operator">&gt;</span>
<span class="token keyword">export</span> <span class="token keyword">function</span> nextTick<span class="token operator">&lt;</span><span class="token constant">T</span><span class="token operator">&gt;</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token operator">:</span> <span class="token constant">T</span><span class="token punctuation">,</span> <span class="token function-variable function">cb</span><span class="token operator">:</span> <span class="token punctuation">(</span><span class="token parameter"><span class="token keyword">this</span><span class="token operator">:</span> <span class="token constant">T</span><span class="token punctuation">,</span> <span class="token operator">...</span>args<span class="token operator">:</span> any<span class="token punctuation">[</span><span class="token punctuation">]</span></span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> any<span class="token punctuation">)</span><span class="token operator">:</span> <span class="token keyword">void</span>
<span class="token keyword">export</span> <span class="token keyword">function</span> nextTick<span class="token operator">&lt;</span><span class="token constant">T</span><span class="token operator">&gt;</span><span class="token punctuation">(</span><span class="token function-variable function">cb</span><span class="token operator">:</span> <span class="token punctuation">(</span><span class="token parameter"><span class="token keyword">this</span><span class="token operator">:</span> <span class="token constant">T</span><span class="token punctuation">,</span> <span class="token operator">...</span>args<span class="token operator">:</span> any<span class="token punctuation">[</span><span class="token punctuation">]</span></span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> any<span class="token punctuation">,</span> <span class="token literal-property property">ctx</span><span class="token operator">:</span> <span class="token constant">T</span><span class="token punctuation">)</span><span class="token operator">:</span> <span class="token keyword">void</span>
<span class="token doc-comment comment">/**
 * <span class="token keyword">@internal</span>
 */</span>
<span class="token keyword">export</span> <span class="token keyword">function</span> <span class="token function">nextTick</span><span class="token punctuation">(</span><span class="token parameter">cb<span class="token operator">?</span><span class="token operator">:</span> <span class="token punctuation">(</span><span class="token parameter"><span class="token operator">...</span>args<span class="token operator">:</span> any<span class="token punctuation">[</span><span class="token punctuation">]</span></span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> any<span class="token punctuation">,</span> ctx<span class="token operator">?</span><span class="token operator">:</span> object</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">let</span> _resolve
  callbacks<span class="token punctuation">.</span><span class="token function">push</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>cb<span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token keyword">try</span> <span class="token punctuation">{</span>
        <span class="token function">cb</span><span class="token punctuation">.</span><span class="token function">call</span><span class="token punctuation">(</span>ctx<span class="token punctuation">)</span>
      <span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span>e<span class="token operator">:</span> any<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token function">handleError</span><span class="token punctuation">(</span>e<span class="token punctuation">,</span> ctx<span class="token punctuation">,</span> <span class="token string">&#39;nextTick&#39;</span><span class="token punctuation">)</span>
      <span class="token punctuation">}</span>
    <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token keyword">if</span> <span class="token punctuation">(</span>_resolve<span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token function">_resolve</span><span class="token punctuation">(</span>ctx<span class="token punctuation">)</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>pending<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    pending <span class="token operator">=</span> <span class="token boolean">true</span>
    <span class="token function">timerFunc</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
  <span class="token punctuation">}</span>
  <span class="token comment">// $flow-disable-line</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>cb <span class="token operator">&amp;&amp;</span> <span class="token keyword">typeof</span> Promise <span class="token operator">!==</span> <span class="token string">&#39;undefined&#39;</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span> <span class="token keyword">new</span> <span class="token class-name">Promise</span><span class="token punctuation">(</span><span class="token parameter">resolve</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
      _resolve <span class="token operator">=</span> resolve
    <span class="token punctuation">}</span><span class="token punctuation">)</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="_6-4-简化后的-nexttick" tabindex="-1"><a class="header-anchor" href="#_6-4-简化后的-nexttick" aria-hidden="true">#</a> 6.4 简化后的 nextTick</h3><div class="language-javascript line-numbers-mode" data-ext="js"><pre class="language-javascript"><code><span class="token keyword">const</span> callbacks<span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span>
<span class="token keyword">let</span> pending <span class="token operator">=</span> <span class="token boolean">false</span>


<span class="token keyword">export</span> <span class="token keyword">function</span> <span class="token function">nextTick</span><span class="token punctuation">(</span><span class="token parameter">cb<span class="token punctuation">,</span> ctx</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">let</span> _resolve

  <span class="token comment">// 存储一个箭头函数到 callbacks，箭头函数中会执行cb</span>
  callbacks<span class="token punctuation">.</span><span class="token function">push</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>cb<span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token keyword">try</span> <span class="token punctuation">{</span>
        <span class="token function">cb</span><span class="token punctuation">.</span><span class="token function">call</span><span class="token punctuation">(</span>ctx<span class="token punctuation">)</span>
      <span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span>e<span class="token operator">:</span> any<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token function">handleError</span><span class="token punctuation">(</span>e<span class="token punctuation">,</span> ctx<span class="token punctuation">,</span> <span class="token string">&#39;nextTick&#39;</span><span class="token punctuation">)</span>
      <span class="token punctuation">}</span>
    <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token keyword">if</span> <span class="token punctuation">(</span>_resolve<span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token function">_resolve</span><span class="token punctuation">(</span>ctx<span class="token punctuation">)</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span>

  <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>pending<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    pending <span class="token operator">=</span> <span class="token boolean">true</span>
    <span class="token function">timerFunc</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
  <span class="token punctuation">}</span>

  <span class="token comment">// 没有传入回调函数，且存在 Promise。返回一个 Promise 对象</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>cb <span class="token operator">&amp;&amp;</span> <span class="token keyword">typeof</span> Promise <span class="token operator">!==</span> <span class="token string">&#39;undefined&#39;</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span> <span class="token keyword">new</span> <span class="token class-name">Promise</span><span class="token punctuation">(</span><span class="token parameter">resolve</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
      _resolve <span class="token operator">=</span> resolve
    <span class="token punctuation">}</span><span class="token punctuation">)</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>每执行一次 <code>nextTick</code> ，就会将 <code>nextTick</code> 的第一个参数 <code>cb</code>，也就是回调函数，存储到一个数组中。</p><p>当 <code>pending</code> 为 <code>false</code> 的时候，执行 <code>timerFunc</code>;</p><h3 id="_6-5-简化后的-timerfunc" tabindex="-1"><a class="header-anchor" href="#_6-5-简化后的-timerfunc" aria-hidden="true">#</a> 6.5 简化后的 timerFunc</h3><div class="language-javascript line-numbers-mode" data-ext="js"><pre class="language-javascript"><code><span class="token keyword">const</span> <span class="token literal-property property">callbacks</span><span class="token operator">:</span> Array<span class="token operator">&lt;</span>Function<span class="token operator">&gt;</span> <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span>
<span class="token keyword">let</span> pending <span class="token operator">=</span> <span class="token boolean">false</span>

<span class="token comment">// 简单来说，就是执行 callbacks 中所有的函数</span>
<span class="token keyword">function</span> <span class="token function">flushCallbacks</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  pending <span class="token operator">=</span> <span class="token boolean">false</span>
  <span class="token keyword">const</span> copies <span class="token operator">=</span> callbacks<span class="token punctuation">.</span><span class="token function">slice</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span>
  callbacks<span class="token punctuation">.</span>length <span class="token operator">=</span> <span class="token number">0</span>
  <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">let</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> copies<span class="token punctuation">.</span>length<span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    copies<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

<span class="token keyword">let</span> timerFunc

<span class="token comment">// Promise MutationObserver setImmediate setTimeout</span>
<span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token keyword">typeof</span> Promise <span class="token operator">!==</span> <span class="token string">&#39;undefined&#39;</span> <span class="token operator">&amp;&amp;</span> <span class="token function">isNative</span><span class="token punctuation">(</span>Promise<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">const</span> p <span class="token operator">=</span> Promise<span class="token punctuation">.</span><span class="token function">resolve</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
  <span class="token function-variable function">timerFunc</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    p<span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span>flushCallbacks<span class="token punctuation">)</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>isIOS<span class="token punctuation">)</span> <span class="token function">setTimeout</span><span class="token punctuation">(</span>noop<span class="token punctuation">)</span>
  <span class="token punctuation">}</span>
  isUsingMicroTask <span class="token operator">=</span> <span class="token boolean">true</span>
<span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token keyword">if</span> <span class="token punctuation">(</span>
  <span class="token operator">!</span>isIE <span class="token operator">&amp;&amp;</span>
  <span class="token keyword">typeof</span> MutationObserver <span class="token operator">!==</span> <span class="token string">&#39;undefined&#39;</span> <span class="token operator">&amp;&amp;</span>
  <span class="token punctuation">(</span><span class="token function">isNative</span><span class="token punctuation">(</span>MutationObserver<span class="token punctuation">)</span> <span class="token operator">||</span>
    MutationObserver<span class="token punctuation">.</span><span class="token function">toString</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">===</span> <span class="token string">&#39;[object MutationObserverConstructor]&#39;</span><span class="token punctuation">)</span>
<span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">let</span> counter <span class="token operator">=</span> <span class="token number">1</span>
  <span class="token keyword">const</span> observer <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">MutationObserver</span><span class="token punctuation">(</span>flushCallbacks<span class="token punctuation">)</span>
  <span class="token keyword">const</span> textNode <span class="token operator">=</span> document<span class="token punctuation">.</span><span class="token function">createTextNode</span><span class="token punctuation">(</span><span class="token function">String</span><span class="token punctuation">(</span>counter<span class="token punctuation">)</span><span class="token punctuation">)</span>
  observer<span class="token punctuation">.</span><span class="token function">observe</span><span class="token punctuation">(</span>textNode<span class="token punctuation">,</span> <span class="token punctuation">{</span>
    <span class="token literal-property property">characterData</span><span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span>
  <span class="token function-variable function">timerFunc</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    counter <span class="token operator">=</span> <span class="token punctuation">(</span>counter <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">)</span> <span class="token operator">%</span> <span class="token number">2</span>
    textNode<span class="token punctuation">.</span>data <span class="token operator">=</span> <span class="token function">String</span><span class="token punctuation">(</span>counter<span class="token punctuation">)</span>
  <span class="token punctuation">}</span>
  isUsingMicroTask <span class="token operator">=</span> <span class="token boolean">true</span>
<span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token keyword">typeof</span> setImmediate <span class="token operator">!==</span> <span class="token string">&#39;undefined&#39;</span> <span class="token operator">&amp;&amp;</span> <span class="token function">isNative</span><span class="token punctuation">(</span>setImmediate<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token function-variable function">timerFunc</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    <span class="token function">setImmediate</span><span class="token punctuation">(</span>flushCallbacks<span class="token punctuation">)</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
  <span class="token function-variable function">timerFunc</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    <span class="token function">setTimeout</span><span class="token punctuation">(</span>flushCallbacks<span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">)</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p><code>timerFunc</code> 看着虽然代码很多，但是本质其实就是函数。执行该函数会启动一个异步任务，这个异步任务会执行数组 <code>callbacks</code> 中的所有回调函数。</p><p>异步任务的实现方式，依据兼容性判断，分四种情况。</p><p>实现顺序为：</p><div class="language-text line-numbers-mode" data-ext="text"><pre class="language-text"><code>1. Promise

2. MutationObserver

3. setImmediate

4. setTimeout

# vue@2.6.11
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="_6-6-说明" tabindex="-1"><a class="header-anchor" href="#_6-6-说明" aria-hidden="true">#</a> 6.6 说明</h3><p><code>nextTick</code> 这个函数，主要作用，就是把接收到的第一个参数（也就是回调函数），以数组存储起来，模拟成一个队列。然后在当前 Tick 的微任务阶段（或者是下一个 Tick 阶段），去执行这些回调函数。</p><p><img src="/onlineBlog/assets/image-20221213000159826.f17c28ed.png" alt="image-20221213000159826"></p><h2 id="_7-总结-vue-中-dom-更新的时机" tabindex="-1"><a class="header-anchor" href="#_7-总结-vue-中-dom-更新的时机" aria-hidden="true">#</a> 7. 总结 Vue 中 DOM 更新的时机</h2><p>整体看一下 Vue 中 DOM 更新的逻辑。</p><ol><li><p>我对 <code>data</code> 中的数据一顿修改。</p></li><li><p>修改了数据，就会触发对应 <code>watcher</code> 上的 <code>queueWatcher</code>。</p><blockquote><p>修改了多个数据，则会触发多次 <code>queueWatcher</code>。</p></blockquote></li><li><p><code>queueWatcher</code> 会向数组 <code>queue</code> 中添加对应 <code>watcher</code> 。</p></li><li><p>封装一个方法 <code>flushSchedulerQueue</code>，通过循环依次触发 <code>queue</code> 中的 <code>watcher.run </code>。</p></li><li><p>调用 <code>nextTick(flushSchedulerQueue)</code></p></li><li><p>当前 Tick 的微任务阶段（或者是下一个 Tick 阶段），执行所有通过 <code>nextTick</code> 传入的回调函数。</p><blockquote><p>也就是 <code>flushSchedulerQueue</code> 会在此阶段执行，也就会更新页面。</p></blockquote></li></ol><h3 id="_7-1-官方文档对异步更新队列的介绍" tabindex="-1"><a class="header-anchor" href="#_7-1-官方文档对异步更新队列的介绍" aria-hidden="true">#</a> 7.1 官方文档对异步更新队列的介绍：</h3><p>可能你还没有注意到，Vue 在更新 DOM 时是<strong>异步</strong>执行的。只要侦听到数据变化，Vue 将开启一个队列，并缓冲在同一事件循环中发生的所有数据变更。如果同一个 watcher 被多次触发，只会被推入到队列中一次。这种在缓冲时去除重复数据对于避免不必要的计算和 DOM 操作是非常重要的。然后，在下一个的事件循环“tick”中，Vue 刷新队列并执行实际 (已去重的) 工作。Vue 在内部对异步队列尝试使用原生的 <code>Promise.then</code>、<code>MutationObserver</code> 和 <code>setImmediate</code>，如果执行环境不支持，则会采用 <code>setTimeout(fn, 0)</code> 代替。</p><p><img src="/onlineBlog/assets/image-20221213100444159.dcfe741c.png" alt="image-20221213100444159"></p><p><code>个人总结：</code></p><p>Vue 更新 DOM 的策略为：异步更新。当数据发生改变，不会立即更新 DOM，而是用数组模拟一个队列，缓冲在同一事件循环中发生的所有数据变更。待到当前 Tick 的微任务阶段（或者是下一个 Tick 阶段）的时候，再统一执行更新操作。</p><blockquote><p>这么做有什么好处？</p><ul><li>减少性能损耗，例如，我修改了一个数据 1000 次，DOM 更新 1000 次。（很明显，经过优化，能够极大的节约性能）</li></ul></blockquote><h2 id="_8-问题的解决办法" tabindex="-1"><a class="header-anchor" href="#_8-问题的解决办法" aria-hidden="true">#</a> 8. 问题的解决办法</h2><p>阅读了源码，查看了官方文档，我了解了 Vue 更新 DOM 的方式。</p><p>回到最初遇到的问题，如果我希望修改了数据，立刻获取 DOM 的值就是最新的，该如何处理？</p><h3 id="_8-1-定时器解决" tabindex="-1"><a class="header-anchor" href="#_8-1-定时器解决" aria-hidden="true">#</a> 8.1 定时器解决</h3><p>Vue 更新 DOM 的时机是当前 Tick 的微任务阶段（或者是下一个 Tick 阶段），想要获取最新 DOM 的内容，我们可以这样：</p><div class="language-javascript line-numbers-mode" data-ext="js"><pre class="language-javascript"><code><span class="token function">setTimeout</span><span class="token punctuation">(</span><span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>
    <span class="token string">&#39;依照事件循环的执行顺序，可以直接通过定时器，再定义一个异步任务。等待时间略大于 0 即可&#39;</span>
  <span class="token punctuation">)</span>
<span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token number">200</span><span class="token punctuation">)</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><blockquote><p><strong>不建议使用定时器的方式，不友好</strong></p></blockquote><h3 id="_8-2-官方提供的解决方式" tabindex="-1"><a class="header-anchor" href="#_8-2-官方提供的解决方式" aria-hidden="true">#</a> 8.2 官方提供的解决方式</h3><p><code>Vue.nextTick( [callback, context] )</code> 或 <code>vm.$nextTick( [callback] )</code></p><p>官方文档，<a href="https://v2.cn.vuejs.org/v2/api/#vm-nextTick" target="_blank" rel="noopener noreferrer">点击这里<span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span></a></p><p>Vue 源码，将 <code>nextTick</code> 这个函数，挂载到了<code>Vue.nextTick</code> 上，也挂载到了 <code>Vue.prototype.$nextTick</code>。（所以这两个方法，本质还是源码中的 <code>nextTick</code> ）</p><blockquote><p>不过 <code>vm.$nextTick</code> 的 <code>this</code> 执行默认为 <code>vm</code></p></blockquote><div class="language-javascript line-numbers-mode" data-ext="js"><pre class="language-javascript"><code>Vue<span class="token punctuation">.</span>nextTick <span class="token operator">=</span> nextTick
<span class="token comment">// vue\src\core\global-api\index.ts  45行</span>

<span class="token class-name">Vue</span><span class="token punctuation">.</span>prototype<span class="token punctuation">.</span><span class="token function-variable function">$nextTick</span> <span class="token operator">=</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token parameter">fn</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">return</span> <span class="token function">nextTick</span><span class="token punctuation">(</span>fn<span class="token punctuation">,</span> <span class="token keyword">this</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span>
<span class="token comment">// vue\src\core\instance\render.ts 99行</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h4 id="_8-2-1-使用示例" tabindex="-1"><a class="header-anchor" href="#_8-2-1-使用示例" aria-hidden="true">#</a> 8.2.1 使用示例</h4><div class="language-javascript line-numbers-mode" data-ext="js"><pre class="language-javascript"><code><span class="token function">mounted</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>
      <span class="token string">&#39;初始输出：&#39;</span><span class="token punctuation">,</span>
      document<span class="token punctuation">.</span><span class="token function">getElementById</span><span class="token punctuation">(</span><span class="token string">&#39;tomato&#39;</span><span class="token punctuation">)</span><span class="token punctuation">.</span>innerText<span class="token punctuation">,</span>
      <span class="token keyword">this</span><span class="token punctuation">.</span>name
    <span class="token punctuation">)</span>

    <span class="token keyword">this</span><span class="token punctuation">.</span>name <span class="token operator">=</span> <span class="token string">&#39;番茄&#39;</span>

    <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">$nextTick</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
      console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>
        <span class="token string">&#39;修改完name的输出：&#39;</span><span class="token punctuation">,</span>
        document<span class="token punctuation">.</span><span class="token function">getElementById</span><span class="token punctuation">(</span><span class="token string">&#39;tomato&#39;</span><span class="token punctuation">)</span><span class="token punctuation">.</span>innerText<span class="token punctuation">,</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span>name
      <span class="token punctuation">)</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span>

    <span class="token comment">// 初始输出： lazy lazy</span>
    <span class="token comment">// 修改完name的输出： 番茄 番茄</span>
<span class="token punctuation">}</span><span class="token punctuation">,</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h4 id="_8-2-2-运行逻辑梳理" tabindex="-1"><a class="header-anchor" href="#_8-2-2-运行逻辑梳理" aria-hidden="true">#</a> 8.2.2 运行逻辑梳理</h4><p>当数据发生改变，就会向 Vue 模拟的队列中插入一个函数 <code>flushSchedulerQueue</code>（这个函数可以更新 DOM）。</p><p>后续用户定义的一个或多个<code>$nextTick</code>，也会插入到 Vue 模拟的队列，但是是在 <code>flushSchedulerQueue</code> 这个方法后面的位置。</p><p>由于这个队列是先进先出的，所以当执行到用户定义的函数时， <code>flushSchedulerQueue</code> 已经执行完毕了，DOM 已经更新，此时获取的 DOM 内容就是最新的了。</p><h2 id="_9-我的思考" tabindex="-1"><a class="header-anchor" href="#_9-我的思考" aria-hidden="true">#</a> 9. 我的思考</h2><h3 id="_9-1-不同-vue-版本-异步任务实现的差异" tabindex="-1"><a class="header-anchor" href="#_9-1-不同-vue-版本-异步任务实现的差异" aria-hidden="true">#</a> 9.1 不同 vue 版本，异步任务实现的差异</h3><p><img src="/onlineBlog/assets/image-20221213103610942.5323d3de.png" alt="image-20221213103610942"></p><h4 id="_9-1-1-vue-2-5-22" tabindex="-1"><a class="header-anchor" href="#_9-1-1-vue-2-5-22" aria-hidden="true">#</a> 9.1.1 vue@2.5.22</h4><div class="language-text line-numbers-mode" data-ext="text"><pre class="language-text"><code>默认微任务，
1. Promise

promise不支持或者强制宏任务
1. setImmediate
2. MessageChannel
3. setTimeout

# vue@2.6.11
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h4 id="_9-1-2-vue-2-6-11" tabindex="-1"><a class="header-anchor" href="#_9-1-2-vue-2-6-11" aria-hidden="true">#</a> 9.1.2 vue@2.6.11</h4><div class="language-text line-numbers-mode" data-ext="text"><pre class="language-text"><code>1. Promise
2. MutationObserver
3. setImmediate
4. setTimeout

# vue@2.6.11
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h4 id="_9-1-3-vue-3-2-45" tabindex="-1"><a class="header-anchor" href="#_9-1-3-vue-3-2-45" aria-hidden="true">#</a> 9.1.3 vue@3.2.45</h4><div class="language-javascript line-numbers-mode" data-ext="js"><pre class="language-javascript"><code><span class="token keyword">function</span> <span class="token function">nextTick</span><span class="token punctuation">(</span><span class="token parameter">fn<span class="token operator">?</span><span class="token operator">:</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token keyword">void</span></span><span class="token punctuation">)</span><span class="token operator">:</span> Promise<span class="token operator">&lt;</span><span class="token keyword">void</span><span class="token operator">&gt;</span> <span class="token punctuation">{</span>
  <span class="token keyword">return</span> fn <span class="token operator">?</span> p<span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span>fn<span class="token punctuation">)</span> <span class="token operator">:</span> p
<span class="token punctuation">}</span>

<span class="token comment">// 直接一个 Promise</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="_9-2-源码中这几个变量有什么作用-pending-waiting-flushing" tabindex="-1"><a class="header-anchor" href="#_9-2-源码中这几个变量有什么作用-pending-waiting-flushing" aria-hidden="true">#</a> 9.2 源码中这几个变量有什么作用？<code>pending</code>，<code>waiting</code>，<code>flushing</code></h3><h4 id="_9-2-1-pending" tabindex="-1"><a class="header-anchor" href="#_9-2-1-pending" aria-hidden="true">#</a> 9.2.1 <code>pending</code></h4><p><code>pending</code> 主要作用在函数 <code>nextTick</code> 中， 第一次调用 <code>nextTick</code> ，<code>pending</code> 为 <code>false</code>，就会注册一个异步任务。</p><p>注册异步任务的时候，会设置 <code>pending</code> 为 <code>true</code>。</p><p>当这个异步任务执行完毕后，会设置 <code>pending</code> 为 <code>false</code>。</p><blockquote><p>我理解这个 <code>pending</code> 主要作用，就是保证一次事件循环，只触发一次异步任务。</p></blockquote><h4 id="_9-2-2-waiting" tabindex="-1"><a class="header-anchor" href="#_9-2-2-waiting" aria-hidden="true">#</a> 9.2.2 <code>waiting</code></h4><p><code>waiting</code> 主要作用在函数 <code>queueWatcher</code> 中， 第一次调用 <code>queueWatcher</code> ，<code>waiting</code> 为 <code>false</code>，就会触发一次 <code>nextTick</code>。</p><p>触发 <code>nextTick</code> 的时候，会设置 <code>waiting</code> 为 <code>true</code>。</p><p>当 <code>nextTick</code> 中的回调 <code>flushSchedulerQueue</code> 执行完毕后，会设置 <code>waiting</code> 为 <code>false</code>。</p><blockquote><ul><li><p>我理解这个 <code>waiting</code> 主要作用，就是保证一次事件循环，只向 <code>nextTick</code> 添加一次 <code>flushSchedulerQueue</code>。</p></li><li><p>函数 <code>queueWatcher</code> 多次调用，存储<code>watcher</code>的数组会更新，但是 <code>flushSchedulerQueue</code> 只添加一次。</p></li></ul></blockquote><h4 id="_9-2-3-flushing" tabindex="-1"><a class="header-anchor" href="#_9-2-3-flushing" aria-hidden="true">#</a> 9.2.3 <code>flushing</code></h4><p><code>flushing</code> 主要作用在函数 <code>queueWatcher</code> 中， 第一次调用 <code>queueWatcher</code> ，<code>flushing</code> 为 <code>false</code>，<code>queue</code> 就直接存储对应的<code>watcher</code>。</p><p>执行 <code>flushSchedulerQueue</code> 的时候，也就是正在更新 DOM 的时候，会设置 <code>flushing</code> 为 <code>true</code>。</p><p><code>flushSchedulerQueue</code> 执行完毕后，会设置 <code>flushing</code> 为 <code>false</code>。</p><p>执行 <code>flushSchedulerQueue</code> 的时候，触发 <code>queueWatcher</code> 就不是单纯的直接向<code>queue</code> 尾部添加 <code>watcher</code> 了，而是如下逻辑：</p><div class="language-javascript line-numbers-mode" data-ext="js"><pre class="language-javascript"><code><span class="token keyword">export</span> <span class="token keyword">function</span> <span class="token function">queueWatcher</span><span class="token punctuation">(</span><span class="token parameter"><span class="token literal-property property">watcher</span><span class="token operator">:</span> Watcher</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>flushing<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    queue<span class="token punctuation">.</span><span class="token function">push</span><span class="token punctuation">(</span>watcher<span class="token punctuation">)</span>
  <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
    <span class="token keyword">let</span> i <span class="token operator">=</span> queue<span class="token punctuation">.</span>length <span class="token operator">-</span> <span class="token number">1</span>
    <span class="token comment">// 从数组最后一项开始遍历，从后往前找，找到第一个待插入 `watcher` 的 id 比当前队列中 `watcher` 的 id 大的位置。把 `watcher` 按照 `id`的插入到队列中，因此 `queue` 的长度发生了变化。</span>
    <span class="token keyword">while</span> <span class="token punctuation">(</span>i <span class="token operator">&gt;</span> index <span class="token operator">&amp;&amp;</span> queue<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">.</span>id <span class="token operator">&gt;</span> watcher<span class="token punctuation">.</span>id<span class="token punctuation">)</span> <span class="token punctuation">{</span>
      i<span class="token operator">--</span>
    <span class="token punctuation">}</span>
    queue<span class="token punctuation">.</span><span class="token function">splice</span><span class="token punctuation">(</span>i <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> watcher<span class="token punctuation">)</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

<span class="token keyword">function</span> <span class="token function">flushSchedulerQueue</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token comment">// 按照 watcher.id 的大小顺序进行排列。</span>
  queue<span class="token punctuation">.</span><span class="token function">sort</span><span class="token punctuation">(</span>sortCompareFn<span class="token punctuation">)</span>

  <span class="token comment">// 循环执行   watcher.run()</span>
  <span class="token keyword">for</span> <span class="token punctuation">(</span>index <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> index <span class="token operator">&lt;</span> queue<span class="token punctuation">.</span>length<span class="token punctuation">;</span> index<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    watcher <span class="token operator">=</span> queue<span class="token punctuation">[</span>index<span class="token punctuation">]</span>
    watcher<span class="token punctuation">.</span><span class="token function">run</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

<span class="token keyword">const</span> sortCompareFn <span class="token operator">=</span> <span class="token punctuation">(</span>a<span class="token operator">:</span> Watcher<span class="token punctuation">,</span> <span class="token literal-property property">b</span><span class="token operator">:</span> Watcher<span class="token punctuation">)</span><span class="token operator">:</span> <span class="token parameter">number</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  <span class="token keyword">return</span> a<span class="token punctuation">.</span>id <span class="token operator">-</span> b<span class="token punctuation">.</span>id
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>因为在 <code>flushSchedulerQueue</code> 的时候，很可能用户会再次添加新的 <code>watcher</code>，这样会再次执行到 <code>queueWatcher</code>。</p><p>此时会遍历 <code>queue</code>，从后往前找，找到第一个待插入 <code>watcher</code> 的 id 比当前队列中 <code>watcher</code> 的 id 大的位置。把 <code>watcher</code> 按照 <code>id</code> 大小的插入到<code>queue</code>中。</p><p><code>为什么需要排序？</code></p><div class="language-text line-numbers-mode" data-ext="text"><pre class="language-text"><code>1.组件的更新由父到子；因为父组件的创建过程是先于子的，所以 watcher 的创建也是先父后子，执行顺序也应该保持先父后子。

2.用户的自定义 watcher 要优先于渲染 watcher 执行；因为用户自定义 watcher 是在渲染 watcher 之前创建的。

3.如果一个组件在父组件的 watcher 执行期间被销毁，那么它对应的 watcher 执行都可以被跳过，所以父组件的 watcher 应该先执行。
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><blockquote><ul><li>我理解这个 <code>flushing</code> 主要作用，就是保证在执行 <code>flushSchedulerQueue</code> 的时候。如果触发了<code>queueWatcher</code>， 那么插入的 <code>watcher</code>，按照<code>id</code> 的大小插入。</li></ul></blockquote><h3 id="_9-3-更新-dom-和渲染-ui-分不清楚" tabindex="-1"><a class="header-anchor" href="#_9-3-更新-dom-和渲染-ui-分不清楚" aria-hidden="true">#</a> 9.3 更新 DOM 和渲染 UI 分不清楚</h3><p>熟悉事件循环的朋友，可以知道，事件循环执行的顺序为：</p><p><strong>页面执行顺序为： 当前的宏任务 &gt; 当前的微任务 &gt; DOM 渲染 &gt; 下一个宏任务 &gt; 下一个微任务 &gt; 下一次 DOM 渲染。</strong></p><p>而 Vue 中却是</p><p><strong>当前的宏任务 &gt; flushSchedulerQueue &gt; 用户自定义的 nextTick 中传入的函数 &gt; DOM 渲染 &gt; 下一个宏任务 &gt;</strong></p><p>一开始我对这里是存在疑惑的，为什么 <strong>DOM 更新</strong> 在 <strong>用户自定义的 nextTick 中传入的函数</strong> 前面。为什么和事件循环说的不一样？</p><p>这个问题我是这样理解的：</p><ul><li><p><code>flushSchedulerQueue</code> 是去更新 DOM 的，它会操作 DOM，例如更新案例中 DOM 的文本。操作完毕后，我们用 JS 再去获取的 DOM 内容就是最新的。</p></li><li><p>而事件循环的<code>DOM 渲染</code> 是指将最新 DOM 树绘制到浏览器上，可以理解为渲染界面。</p></li></ul><h3 id="_9-4-性能优化的思路" tabindex="-1"><a class="header-anchor" href="#_9-4-性能优化的思路" aria-hidden="true">#</a> 9.4 性能优化的思路？</h3><p>短时间，多次修改某一&quot;数据&quot;。如果只关注&quot;数据&quot;最后的结果，而且对时效性要求不高。<strong>可以考虑在当前 Tick 中的微任务队列中统一进行处理</strong>。</p><blockquote><ul><li>说到这里，让我想到页面的<code>重排重绘</code> ，浏览器会自带优化：<strong><em>通过队列化修改和批量运行的方法，减少重排/重绘版次</em></strong>。</li><li>两者思路有些类似。</li></ul></blockquote><h2 id="end" tabindex="-1"><a class="header-anchor" href="#end" aria-hidden="true">#</a> end</h2><p><strong>总结自己的收获：</strong></p><ol><li>了解到 Vue 在更新 DOM 时是<strong>异步</strong>执行的。</li><li>学习了 Vue 是如何实现一个异步队列的思路。</li><li>了解了 Vue 在实现异步任务的兼容性处理。</li><li>对事件循环又有了一个更好的认知。</li></ol></div><!--[--><!--]--></div><footer class="page-meta"><!----><!----><div class="meta-item contributors"><span class="meta-item-label">Contributors: </span><span class="meta-item-info"><!--[--><!--[--><span class="contributor" title="email: 6559210+lazy_tomato@user.noreply.gitee.com">tomato</span><!----><!--]--><!--]--></span></div></footer><!----><!--[--><!--]--></main><!--]--></div><!----><!--]--></div>
    <script type="module" src="/onlineBlog/assets/app.acfc35a6.js" defer></script>
  </body>
</html>
